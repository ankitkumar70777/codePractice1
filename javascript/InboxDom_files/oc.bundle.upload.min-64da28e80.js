function onApiLoad(){gapi.load("auth",{callback:onAuthApiLoad}),gapi.load("picker",{callback:onPickerApiLoad})}function onAuthApiLoad(){window.gapi.auth.authorize({client_id:gdrive_clientId,scope:scope,immediate:!1},handleAuthResult)}function onPickerApiLoad(){pickerApiLoaded=!0}function handleAuthResult(e){e&&!e.error&&(oauthToken=e.access_token,oauthData=e,createPicker())}function createPicker(){if(pickerApiLoaded&&oauthToken){var e=new google.picker.DocsView(google.picker.ViewId.DOCS);e.setMode(google.picker.DocsViewMode.LIST),e.setIncludeFolders(!0),e.setOwnedByMe(!0);(new google.picker.PickerBuilder).addView(e).setOAuthToken(oauthToken).setDeveloperKey(gdrive_developerKey).setCallback(pickerCallback).build().setVisible(!0)}}function pickerCallback(e){if(e[google.picker.Response.ACTION]==google.picker.Action.PICKED){var t=e[google.picker.Response.DOCUMENTS][0],o={fileId:t[google.picker.Document.ID],fileName:t[google.picker.Document.NAME],token:oauthToken,mimeType:t[google.picker.Document.MIME_TYPE]};!0===qgGdrive.drive.checkUsesGdrive()&&qgGdrive.drive.setFile(o.fileName,o.fileId,o.mimeType,o.token);document.querySelector("#drive_picker > .btn-status").style.background="transparent url('"+static_server+"/images/status-ok.png') no-repeat";var r=document.getElementById("gdrive_input");if(r)return void r.setAttribute("value",JSON.stringify(o));var i=document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("id","gdrive_input"),i.setAttribute("name","gdrive_input"),i.setAttribute("value",JSON.stringify(o)),document.getElementById("forms").appendChild(i)}}window.assetsloadedupload=!0,function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery-ui/ui/widget"],e):"object"==typeof exports?e(require("jquery"),require("./vendor/jquery.ui.widget")):e(window.jQuery)}(function(e){"use strict";function t(t){var o="dragover"===t;return function(r){r.dataTransfer=r.originalEvent&&r.originalEvent.dataTransfer;var i=r.dataTransfer;i&&-1!==e.inArray("Files",i.types)&&!1!==this._trigger(t,e.Event(t,{delegatedEvent:r}))&&(r.preventDefault(),o&&(i.dropEffect="copy"))}}e.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||e('<input type="file"/>').prop("disabled")),e.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:undefined,fileInput:undefined,replaceFileInput:!0,paramName:undefined,singleFileUploads:!0,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:undefined,forceIframeTransport:!1,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:!0,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,uniqueFilenames:undefined,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,o){return t=this.messages[t]||t.toString(),o&&e.each(o,function(e,o){t=t.replace("{"+e+"}",o)}),t},formData:function(e){return e.serializeArray()},add:function(t,o){if(t.isDefaultPrevented())return!1;(o.autoUpload||!1!==o.autoUpload&&e(this).fileupload("option","autoUpload"))&&o.process().done(function(){o.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,o){var r=e-this.timestamp;return(!this.bitrate||!o||r>o)&&(this.bitrate=(t-this.loaded)*(1e3/r)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var o;return"function"===e.type(t.formData)?t.formData(t.form):e.isArray(t.formData)?t.formData:"object"===e.type(t.formData)?(o=[],e.each(t.formData,function(e,t){o.push({name:e,value:t})}),o):[]},_getTotal:function(t){var o=0;return e.each(t,function(e,t){o+=t.size||1}),o},_initProgressObject:function(t){var o={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,o):t._progress=o},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(t,o){if(t.lengthComputable){var r,i=Date.now?Date.now():(new Date).getTime();if(o._time&&o.progressInterval&&i-o._time<o.progressInterval&&t.loaded!==t.total)return;o._time=i,r=Math.floor(t.loaded/t.total*(o.chunkSize||o._progress.total))+(o.uploadedBytes||0),this._progress.loaded+=r-o._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(i,this._progress.loaded,o.bitrateInterval),o._progress.loaded=o.loaded=r,o._progress.bitrate=o.bitrate=o._bitrateTimer.getBitrate(i,r,o.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:t}),o),this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var o=this,r=t.xhr?t.xhr():e.ajaxSettings.xhr();r.upload&&(e(r.upload).bind("progress",function(e){var r=e.originalEvent;e.lengthComputable=r.lengthComputable,e.loaded=r.loaded,e.total=r.total,o._onProgress(e,t)}),t.xhr=function(){return r})},_deinitProgressListener:function(t){var o=t.xhr?t.xhr():e.ajaxSettings.xhr();o.upload&&e(o.upload).unbind("progress")},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_getUniqueFilename:function(e,t){return e=String(e),t[e]?(e=e.replace(/(?: \(([\d]+)\))?(\.[^.]+)?$/,function(e,t,o){return" ("+(t?Number(t)+1:1)+")"+(o||"")}),this._getUniqueFilename(e,t)):(t[e]=!0,e)},_initXHRData:function(t){var o,r=this,i=t.files[0],n=t.multipart||!e.support.xhrFileUpload,a="array"===e.type(t.paramName)?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange),n&&!t.blob&&this._isInstanceOf("File",i)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(i.uploadName||i.name)+'"'),n?e.support.xhrFormDataFileUpload&&(t.postMessage?(o=this._getFormData(t),t.blob?o.push({name:a,value:t.blob}):e.each(t.files,function(r,i){o.push({name:"array"===e.type(t.paramName)&&t.paramName[r]||a,value:i})})):(r._isInstanceOf("FormData",t.formData)?o=t.formData:(o=new FormData,e.each(this._getFormData(t),function(e,t){o.append(t.name,t.value)})),t.blob?o.append(a,t.blob,i.uploadName||i.name):e.each(t.files,function(i,n){if(r._isInstanceOf("File",n)||r._isInstanceOf("Blob",n)){var s=n.uploadName||n.name;t.uniqueFilenames&&(s=r._getUniqueFilename(s,t.uniqueFilenames)),o.append("array"===e.type(t.paramName)&&t.paramName[i]||a,n,s)}})),t.data=o):(t.contentType=i.type||"application/octet-stream",t.data=t.blob||i),t.blob=null},_initIframeSettings:function(t){var o=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&o&&o!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var o=e(t.fileInput),r=t.paramName;return r?e.isArray(r)||(r=[r]):(r=[],o.each(function(){for(var t=e(this),o=t.prop("name")||"files[]",i=(t.prop("files")||[1]).length;i;)r.push(o),i-=1}),r.length||(r=[o.prop("name")||"files[]"])),r},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||"string"===e.type(t.form.prop("method"))&&t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&"PATCH"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var o=e.extend({},this.options,t);return this._initFormSettings(o),this._initDataSettings(o),o},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,o,r){var i=e.Deferred(),n=i.promise();return o=o||this.options.context||n,!0===t?i.resolveWith(o,r):!1===t&&i.rejectWith(o,r),n.abort=i.promise,this._enhancePromise(n)},_addConvenienceMethods:function(t,o){var r=this,i=function(t){return e.Deferred().resolveWith(r,t).promise()};o.process=function(t,n){return(t||n)&&(o._processQueue=this._processQueue=(this._processQueue||i([this])).then(function(){return o.errorThrown?e.Deferred().rejectWith(r,[o]).promise():i(arguments)}).then(t,n)),this._processQueue||i([this])},o.submit=function(){return"pending"!==this.state()&&(o.jqXHR=this.jqXHR=!1!==r._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)&&r._onSend(t,this)),this.jqXHR||r._getXHRPromise()},o.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",r._trigger("fail",null,this),r._getXHRPromise(!1))},o.state=function(){return this.jqXHR?r._getDeferredState(this.jqXHR):this._processQueue?r._getDeferredState(this._processQueue):void 0},o.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===r._getDeferredState(this._processQueue)},o.progress=function(){return this._progress},o.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),o=t&&t.split("-"),r=o&&o.length>1&&parseInt(o[1],10);return r&&r+1},_chunkedUpload:function(t,o){t.uploadedBytes=t.uploadedBytes||0;var r,i,n=this,a=t.files[0],s=a.size,l=t.uploadedBytes,d=t.maxChunkSize||s,u=this._blobSlice,p=e.Deferred(),c=p.promise();return!(!(this._isXHRUpload(t)&&u&&(l||("function"===e.type(d)?d(t):d)<s))||t.data)&&(!!o||(l>=s?(a.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",a.error])):(i=function(){var o=e.extend({},t),c=o._progress.loaded;o.blob=u.call(a,l,l+("function"===e.type(d)?d(o):d),a.type),o.chunkSize=o.blob.size,o.contentRange="bytes "+l+"-"+(l+o.chunkSize-1)+"/"+s,n._trigger("chunkbeforesend",null,o),n._initXHRData(o),n._initProgressListener(o),r=(!1!==n._trigger("chunksend",null,o)&&e.ajax(o)||n._getXHRPromise(!1,o.context)).done(function(r,a,d){l=n._getUploadedBytes(d)||l+o.chunkSize,c+o.chunkSize-o._progress.loaded&&n._onProgress(e.Event("progress",{lengthComputable:!0,loaded:l-o.uploadedBytes,total:l-o.uploadedBytes}),o),t.uploadedBytes=o.uploadedBytes=l,o.result=r,o.textStatus=a,o.jqXHR=d,n._trigger("chunkdone",null,o),n._trigger("chunkalways",null,o),l<s?i():p.resolveWith(o.context,[r,a,d])}).fail(function(e,t,r){o.jqXHR=e,o.textStatus=t,o.errorThrown=r,n._trigger("chunkfail",null,o),n._trigger("chunkalways",null,o),p.rejectWith(o.context,[e,t,r])}).always(function(){n._deinitProgressListener(o)})},this._enhancePromise(c),c.abort=function(){return r.abort()},i(),c)))},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,o,r,i){var n=i._progress.total,a=i._response;i._progress.loaded<n&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:n,total:n}),i),a.result=i.result=t,a.textStatus=i.textStatus=o,a.jqXHR=i.jqXHR=r,this._trigger("done",null,i)},_onFail:function(e,t,o,r){var i=r._response;r.recalculateProgress&&(this._progress.loaded-=r._progress.loaded,this._progress.total-=r._progress.total),i.jqXHR=r.jqXHR=e,i.textStatus=r.textStatus=t,i.errorThrown=r.errorThrown=o,this._trigger("fail",null,r)},_onAlways:function(e,t,o,r){this._trigger("always",null,r)},_onSend:function(t,o){o.submit||this._addConvenienceMethods(t,o);var r,i,n,a,s=this,l=s._getAJAXSettings(o),d=function(){return s._sending+=1,l._bitrateTimer=new s._BitrateTimer,r=r||((i||!1===s._trigger("send",e.Event("send",{delegatedEvent:t}),l))&&s._getXHRPromise(!1,l.context,i)||s._chunkedUpload(l)||e.ajax(l)).done(function(e,t,o){s._onDone(e,t,o,l)}).fail(function(e,t,o){s._onFail(e,t,o,l)}).always(function(e,t,o){if(s._deinitProgressListener(l),s._onAlways(e,t,o,l),s._sending-=1,s._active-=1,l.limitConcurrentUploads&&l.limitConcurrentUploads>s._sending)for(var r=s._slots.shift();r;){if("pending"===s._getDeferredState(r)){r.resolve();break}r=s._slots.shift()}0===s._active&&s._trigger("stop")})};return this._beforeSend(t,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(n=e.Deferred(),this._slots.push(n),a=n.then(d)):(this._sequence=this._sequence.then(d,d),a=this._sequence),a.abort=function(){return i=[undefined,"abort","abort"],r?r.abort():(n&&n.rejectWith(l.context,i),d())},this._enhancePromise(a)):d()},_onAdd:function(t,o){var r,i,n,a,s=this,l=!0,d=e.extend({},this.options,o),u=o.files,p=u.length,c=d.limitMultiFileUploads,f=d.limitMultiFileUploadSize,g=d.limitMultiFileUploadSizeOverhead,h=0,v=this._getParamName(d),m=0;if(!p)return!1;if(f&&u[0].size===undefined&&(f=undefined),(d.singleFileUploads||c||f)&&this._isXHRUpload(d))if(d.singleFileUploads||f||!c)if(!d.singleFileUploads&&f)for(n=[],r=[],a=0;a<p;a+=1)h+=u[a].size+g,(a+1===p||h+u[a+1].size+g>f||c&&a+1-m>=c)&&(n.push(u.slice(m,a+1)),i=v.slice(m,a+1),i.length||(i=v),r.push(i),m=a+1,h=0);else r=v;else for(n=[],r=[],a=0;a<p;a+=c)n.push(u.slice(a,a+c)),i=v.slice(a,a+c),i.length||(i=v),r.push(i);else n=[u],r=[v];return o.originalFiles=u,e.each(n||u,function(i,a){var d=e.extend({},o);return d.files=n?a:[a],d.paramName=r[i],s._initResponseObject(d),s._initProgressObject(d),s._addConvenienceMethods(t,d),l=s._trigger("add",e.Event("add",{delegatedEvent:t}),d)}),l},_replaceFileInput:function(t){var o=t.fileInput,r=o.clone(!0),i=o.is(document.activeElement);t.fileInputClone=r,e("<form></form>").append(r)[0].reset(),o.after(r).detach(),i&&r.focus(),e.cleanData(o.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===o[0]?r[0]:t}),o[0]===this.element[0]&&(this.element=r)},_handleFileTreeEntry:function(t,o){var r,i=this,n=e.Deferred(),a=[],s=function(e){e&&!e.entry&&(e.entry=t),n.resolve([e])},l=function(e){i._handleFileTreeEntries(e,o+t.name+"/").done(function(e){n.resolve(e)}).fail(s)},d=function(){r.readEntries(function(e){e.length?(a=a.concat(e),d()):l(a)},s)};return o=o||"",t.isFile?t._file?(t._file.relativePath=o,n.resolve(t._file)):t.file(function(e){e.relativePath=o,n.resolve(e)},s):t.isDirectory?(r=t.createReader(),d()):n.resolve([]),n.promise()},_handleFileTreeEntries:function(t,o){var r=this;return e.when.apply(e,e.map(t,function(e){return r._handleFileTreeEntry(e,o)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var o=t.items;return o&&o.length&&(o[0].webkitGetAsEntry||o[0].getAsEntry)?this._handleFileTreeEntries(e.map(o,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var o,r,i=t.prop("webkitEntries")||t.prop("entries");if(i&&i.length)return this._handleFileTreeEntries(i);if(o=e.makeArray(t.prop("files")),o.length)o[0].name===undefined&&o[0].fileName&&e.each(o,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(!(r=t.prop("value")))return e.Deferred().resolve([]).promise();o=[{name:r.replace(/^.*\\/,"")}]}return e.Deferred().resolve(o).promise()},_getFileInputFiles:function(t){return t instanceof e&&1!==t.length?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var o=this,r={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(r.fileInput).always(function(i){r.files=i,o.options.replaceFileInput&&o._replaceFileInput(r),!1!==o._trigger("change",e.Event("change",{delegatedEvent:t}),r)&&o._onAdd(t,r)})},_onPaste:function(t){var o=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,r={files:[]};o&&o.length&&(e.each(o,function(e,t){var o=t.getAsFile&&t.getAsFile();o&&r.files.push(o)}),!1!==this._trigger("paste",e.Event("paste",{delegatedEvent:t}),r)&&this._onAdd(t,r))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var o=this,r=t.dataTransfer,i={};r&&r.files&&r.files.length&&(t.preventDefault(),this._getDroppedFiles(r).always(function(r){i.files=r,!1!==o._trigger("drop",e.Event("drop",{delegatedEvent:t}),i)&&o._onAdd(t,i)}))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_destroy:function(){this._destroyEventHandlers()},_setOption:function(t,o){var r=-1!==e.inArray(t,this._specialOptions);r&&this._destroyEventHandlers(),this._super(t,o),r&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;t.fileInput===undefined?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),o=t.pop();return t.shift(),new RegExp(t.join("/"),o)},_isRegExpOption:function(t,o){return"url"!==t&&"string"===e.type(o)&&/^\/.*\/[igm]{0,3}$/.test(o)},_initDataAttributes:function(){var t=this,o=this.options,r=this.element.data();e.each(this.element[0].attributes,function(e,i){var n,a=i.name.toLowerCase();/^data-/.test(a)&&(a=a.slice(5).replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()}),n=r[a],t._isRegExpOption(a,n)&&(n=t._getRegExp(n)),o[a]=n)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var o=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,o._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var o,r,i=this,n=e.Deferred(),a=n.promise();return a.abort=function(){return r=!0,o?o.abort():(n.reject(null,"abort","abort"),a)},this._getFileInputFiles(t.fileInput).always(function(e){if(!r){if(!e.length)return void n.reject();t.files=e,o=i._onSend(null,t),o.then(function(e,t,o){n.resolve(e,t,o)},function(e,t,o){n.reject(e,t,o)})}}),this._enhancePromise(a)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),function(e){"use strict";var t=function(e,o){var r=/[^\w\-\.:]/.test(e)?new Function(t.arg+",tmpl","var _e=tmpl.encode"+t.helper+",_s='"+e.replace(t.regexp,t.func)+"';return _s;"):t.cache[e]=t.cache[e]||t(t.load(e));return o?r(o,t):function(e){return r(e,t)}};t.cache={},t.load=function(e){return document.getElementById(e).innerHTML},t.regexp=/([\s'\\])(?!(?:[^{]|\{(?!%))*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g,t.func=function(e,t,o,r,i,n){return t?{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[t]||"\\"+t:o?"="===o?"'+_e("+r+")+'":"'+("+r+"==null?'':"+r+")+'":i?"';":n?"_s+='":void 0},t.encReg=/[<>&"'\x00]/g,t.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},t.encode=function(e){return(null==e?"":""+e).replace(t.encReg,function(e){return t.encMap[e]||""})},t.arg="o",t.helper=",print=function(s,e){_s+=e?(s==null?'':s):_e(s);},include=function(s,d){_s+=tmpl(s,d);}","function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:e.tmpl=t}(this);var scope=["https://www.googleapis.com/auth/drive.readonly","https://www.googleapis.com/auth/drive.install"],pickerApiLoaded=!1,oauthToken,oauthData;!function(){"use strict";function e(){try{var e=new Blob(["a","b","c"]);if(3!==e.size)return!1;return 2===e.slice(0,2).size}catch(t){}return!1}function t(e){return!!Ae(e)&&(!!Re(e.id)&&(!!Le(e.server)&&(!!Le(e.token)&&!!Pe(e.conversion))))}function o(e){return!!Ae(e)&&(!!Re(e.id)&&(!!He(e.source)&&(!!Le(e.type)&&(!!Ae(e.metadata)&&!(!He(e.status)||!n(e.status))))))}function r(e){return!!Ae(e)&&(!!Ve(e,"id")&&(!!Re(e.id.job)&&(!!Re(e.id.input)&&(!!Ae(e.metadata)&&!!je(e.completed)))))}function i(e){return!!Le(e)&&Ge(dt,e)}function n(e){return!!Le(e)&&Ge(st,e)}function a(e){return!!Le(e)&&Ge(pt,e)}function s(e){return!!Le(e)&&Ge(ot,e)}function l(e){return!!Le(e)&&Ge(it,e)}function d(e){return!!Ae(e)&&(Ve(e,"fileUploadInputId")&&Ve(e,"maxFileSize"))}function u(e){Ke(e),this._type=e,this._name="",this._callback=null,this._localId=null,this._size=null,this._inputId=null,this._status=lt,this._uploadData=null}function p(){this.listener=[]}function c(e){if(this._isValid=!0,this._data={},this._inputs={},!t(e))return void(this._isValid=!1);this._data=e}function f(e,t){Ae(t)||(t={}),this._api=e,this._jobInfoHelper=null,this._isJobCreationFailed=!1,this._isCreating=!1,this._isUploadServerReachable=!0}function g(e){this._inputs=[],this._maxNumberOfInputs=Ct,e.hasOwnProperty("maxNumberOfInputs")&&(this._maxNumberOfInputs=e.maxNumberOfInputs)}function h(e){this._uploader=e}function v(){this.maxFileSize=8589934592}function m(e,t){this._uploader=e,this._config=new v,Ae(t)&&Ve(t,"maxFileSize")&&(this._config=t)}function b(e){this._maxRetries=20,this._maxTimeOut_s=10,"number"==typeof e&&(this._maxRetries=e),this._currentRetry=0,this._sucessfulChunks=0,this._failedChunks=0}function _(e){var t=0,o="",r="";try{w(e),r="current retry: "+e.pgRetryHandler.getCurrentRetry(),r+=" | uploaded bytes: "+e.uploadedBytes,r+=" | file size: "+e.files[0].size,r+=" | file name: "+e.files[0].name;try{r+=" | file last modified: "+e.files[0].lastModified}catch(i){}e.hasOwnProperty("jqXHR")||(r+=" | jqXHR missing!");try{e.jqXHR.hasOwnProperty("status")&&(r+=" | status code: "+e.jqXHR.status)}catch(i){}try{e.jqXHR.hasOwnProperty("responseText")&&("string"==typeof e.jqXHR.responseText?r+=" | response text: "+e.jqXHR.responseText.substr(0,512):r+=" | response text: NOT A STRING "+JSON.stringify(e.jqXHR.responseText))}catch(i){}try{e.jqXHR.hasOwnProperty("responseJSON")&&("object"==typeof e.jqXHR.responseJSON?r+=" | response json: "+JSON.stringify(e.jqXHR.responseJSON):r+=" | response json: NOT AN OBJECT "+JSON.stringify(e.jqXHR.responseJSON))}catch(i){}e.hasOwnProperty("url")?"string"!=typeof e.url?r+=" | url: URL NOT A STRING":""===e.url?r+=" | url: EMPTY URL":r+=' | url: "'+e.url+'"':r+=" | url: NO URL",e.hasOwnProperty("headers")?r+=" | headers: "+JSON.stringify(e.headers):r+=" | headers: NO HEADERS";try{C(e.url)&&(r+=" | use upload fallback: true")}catch(i){}t=e.textStatus,o=e.errorThrown}catch(i){r="exception during logging",i.hasOwnProperty("message")&&(r+=": "+i.message)}Y.log("qgMultiUpload fileUpload retry",{info:r,ajax_status:t,ajax_error:o})}function y(e){var t=0,o="",r="";try{w(e),r="retries: "+e.pgRetryHandler.getCurrentRetry(),r+=" | uploaded bytes: "+e.uploadedBytes;try{r+=" | file size: "+e.files[0].size}catch(i){}try{r+=" | file last modified: "+e.files[0].lastModified}catch(i){}try{r+=" | server response: "+e.jqXHR.responseText.substr(0,250)}catch(i){}try{r+=" | server error message: "+e.jqXHR.responseJSON.error.substr(0,250)}catch(i){}try{r+=" | status code: "+e.jqXHR.status}catch(i){}try{C(e.url)&&(r+=" | use upload fallback: true",Y.log("qgMultiUpload fileUpload with fallback fail"))}catch(i){}t=e.textStatus,o=e.errorThrown}catch(i){r="exception during logging",i.hasOwnProperty("message")&&(r+=": "+i.message)}Y.log("qgMultiUpload fileUpload fail",{info:r,ajax_status:t,ajax_error:o})}function w(e){var t=null,o=null,r=null;try{Le(e.files[0].name)&&(t=e.files[0].name)}catch(n){}try{Je(e.files[0].size)&&(o=e.files[0].size)}catch(n){}try{Je(e.files[0].lastModified)&&(r=e.files[0].lastModified)}catch(n){}if(t!==e.pgInitialName||o!==e.pgInitialSize){var i="name initial: "+e.pgInitialName+" name now: "+t+" size initial: "+e.pgInitialSize+" size now: "+o+" last modified now: "+r;Y.log("qgMultiUpload fileUpload info - file data changed",{info:i})}}function I(){this._baseChunkSize=1e6,this._minChunkSize=1e5,this._maxChunkSize=1e8,this._speedModifier=3,this._maxSpeedModifier=5}function C(e){return-1!==e.toLowerCase().indexOf("/upload-redirect/")}function x(){this.maxFileSize=8589934592,this.enablePasswords=!0,this.enableUploadFallback=!1,this.fileUploadInputId="#fileUploadInput"}function q(e,t){function o(e){return r._dynamicChunkHandler.getDynamicChunkSize(e)}tt(t),this._config=t,this._uploader=e,this._dynamicChunkHandler=new I,Oe(this._config.fileUploadInputId),he(1===$(this._config.fileUploadInputId).length);var r=this,i={singleFileUploads:!0,sequentialUploads:!1,maxChunkSize:o,autoUpload:!1,progressInterval:500,messages:{unknownError:"Unknown error",maxNumberOfFiles:"Maximum number of files exceeded",acceptFileTypes:"File type not allowed",maxFileSize:"File is too large",minFileSize:"File is too small",uploadedBytes:"Uploaded bytes exceed file size"}},n=$(this._config.fileUploadInputId),a=n.fileupload(i);a.on("fileuploadadd",function(e,t){r._processFileUploadAdd(e,t)}),a.on("fileuploadsubmit",function(e,t){r._processFileUploadSubmit(e,t)}),a.on("fileuploaddone",function(e,t){r._processFileUploadDone(e,t)}),a.on("fileuploadfail",function(e,t){r._processFileUploadFail(e,t)}),a.on("fileuploadprogress",function(e,t){r._processFileUploadProgress(e,t)}),a.on("fileuploadchunkdone",function(e,t){t.pgRetryHandler.handleChunkSuccess(),r._dynamicChunkHandler.increaseChunkSpeed()})}function S(){this.maxFileSize=8589934592,this.clientId=null,this.developerKey=null}function O(e,t){this._uploader=e,this._config=new S,Ae(t)&&Ve(t,"maxFileSize")&&(this._config=t),this._oauthToken=null}function F(e){this._uploader=e}function k(e){this.error=_t,this.size=null,e&&(It(e),this.error=e)}function U(e,t){Ie(t),this._apiHelper=e,this._isEnabled=!0,this._inputList=new g(t),this._inputEventHandler=new p,this._globalEventHandler=new p,this._job=new f(e,t),this._queueIsBeingProcessed=!1,this._sentLogAboutMaxInputs=!1,this._maxFileSize=8589934592,Je(t.maxFileSize)&&(this._maxFileSize=t.maxFileSize),this._blockYouTubeUrls=!0,this._singleInput=1===t.maxNumberOfInputs,this._enablePasswords=!0===t.enablePasswords,this._showPasswordOnlyForSingleInput=!0===t.showPasswordOnlyForSingleInput,t.hasOwnProperty("blockYouTubeUrls")&&(this._blockYouTubeUrls=t.blockYouTubeUrls),this._addDropboxHelper=null,this._addGdriveHelper=null,this._addFileUploadHelper=null,this._addInputIdHelper=null,this._addExternalUrlHelper=null,this._setupAddHelper(t),this._jobData={},t.hasOwnProperty("jobData")&&(this._jobData=t.jobData),t.hasOwnProperty("jobId")&&this._initFromJobId(t.jobId)}function j(e){if(this._isValid=!0,this._rawData={},!o(e))return void(this._isValid=!1);this._rawData=e}function D(e){if(!He(e))return e;try{var t=JSON.parse(e);if(Ae(t))return Y.log("qgApiHelper server response was fixed",JSON.stringify(e)),t}catch(o){}return Y.log("qgApiHelper server response was not fixed",JSON.stringify(e)),e}function A(e){return Ae(e)&&Ve(e,"code")&&Ve(e,"text")?{code:e.code,text:e.text}:null}function P(e){if(!Ae(e))return null;if(!Ae(e.responseJSON))return null;var t=e.responseJSON;return Ve(t,"code")&&Ve(t,"message")?{code:t.code,message:t.message}:null}function J(e,t){this.api=e,this.paymentRequiredCallback=null,De(t.paymentRequiredCallback)&&(this.paymentRequiredCallback=t.paymentRequiredCallback)}function H(e,t){Ie(t),this.api=e,this.baseUrlApi="",Le(t.baseUrlApi)&&(this.baseUrlApi=t.baseUrlApi)}function R(e){this._logger=Y,Ae(e)&&Ve(e,"logger")&&(we(e.logger.log),this._logger=e.logger)}function E(e){qe(e),this.maxCacheTimeSeconds=e,this.data={}}function N(e,t){Oe(e),this.apiHelper=null,"oc"===e?this.apiHelper=new H(this,t):"sat"===e&&(this.apiHelper=new J(this,t)),be(this.apiHelper,'type must be "sat" or "oc"'),this.ajaxWrapper=new R,this.jobCache=new E(Dt),this.numberOfCurrentJobInfoRequests={},this.baseData={},Ae(t.baseApiData)&&(this.baseData=t.baseApiData),this.baseAjaxOptions={dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},cache:!1,maxRetries:3,retryTimeout:!0,retry400:!1,retry500:!0,retryOther:!0}}function T(e,t,o,r){At=o,"string"==typeof r&&(Jt=r),$.getScript(e+"?render="+t+"&render=explicit").done(function(e,o){z(t)})}function z(e){if("undefined"==typeof window.grecaptcha||"undefined"==typeof window.grecaptcha.render||"undefined"==typeof window.grecaptcha.execute||"undefined"==typeof window.grecaptcha.getResponse||"undefined"==typeof window.grecaptcha.ready||"undefined"==typeof window.grecaptcha.reset)return void setTimeout(function(){z(e)},500);window.grecaptcha.render("recaptchaContainer",{sitekey:e,size:"invisible",callback:M}),window.grecaptcha.execute()}function M(e){$("<input>").attr({type:"hidden",id:"captcha",name:"g-recaptcha-response",value:e}).appendTo(Jt),$("<input>").attr({type:"hidden",id:"isInvisibleCaptcha",name:"is-invisible-captcha",value:!0}).appendTo(Jt),At(e)}function L(e,t,o){if(!0===window.enable_payment_modal)return window.modal_reason=t,void 0!==o&&(window.fileSize=o),$("body").addClass("has-modal"),$(".signup-modal-backdrop").removeClass("hidden").addClass("show"),void B("register");window.location.href=e}function B(e){$.get({url:ao+"/tpl/"+e+"?lang="+$("html").prop("lang"),cache:!1,xhrFields:{withCredentials:!0},data:{reason:window.modal_reason}}).done(function(e){$(".signup-modal .signup-page").html(e)}).fail(function(e){$("#generic-error").removeClass("hidden")})}function G(e,t){var o=$(e);o.find(".form-group").removeClass("has-errors").find(".form-error").addClass("hidden");var r=o.find("input, select"),i=!1;return r.each(function(e,o){o=$(o);var r=o.attr("name"),n=o.val();if("_email"===r){if(""===n||!1===n)return i=!0,void o.parents(".form-group").addClass("has-errors").find(".form-error#email-empty, .form-error.error-icon").removeClass("hidden");if("signup"===t&&!/.+@.+\..+/.test(n))return i=!0,void o.parents(".form-group").addClass("has-errors").find(".form-error#email-invalid, .form-error.error-icon").removeClass("hidden")}if("_password"===r){if(""===n||!1===n)return i=!0,void o.parents(".form-group").addClass("has-errors").find(".form-error#pw-empty, .form-error.error-icon").removeClass("hidden");if("signup"===t&&n.length<5)return i=!0,void o.parents(".form-group").addClass("has-errors").find(".form-error#pw-invalid, .form-error.error-icon").removeClass("hidden")}if("_tos"===r&&!o.is(":checked"))return i=!0,void o.parents(".form-group").addClass("has-errors").find(".form-error, .form-error.error-icon").removeClass("hidden")}),!i}function V(){var e=$("#signup-form").serialize();$.post({url:ao+"/register",cache:!1,xhrFields:{withCredentials:!0},data:e}).done(function(e){if("string"==typeof e.message){if("success"===e.message)return void B("register-success");if($("#register-submit").prop("disabled",!1).find("i").removeClass("fa-spinner fa-spin"),"email empty"===e.message)return void $("input#email").parents(".form-group").addClass("has-errors").find(".form-error#email-empty, .form-error.error-icon").removeClass("hidden");if("email invalid"===e.message)return void $("input#email").parents(".form-group").addClass("has-errors").find(".form-error#email-invalid, .form-error.error-icon").removeClass("hidden");if("email provider blocked"===e.message)return void $("input#email").parents(".form-group").addClass("has-errors").find(".form-error#email-blocked, .form-error.error-icon").removeClass("hidden");if("password empty"===e.message)return void $("input#password").parents(".input-group").addClass("has-errors").find(".form-error#pw-empty, .form-error.error-icon").removeClass("hidden");if("tos not accepted"===e.message)return void $("input#tos").parents(".form-group").addClass("has-errors")}$("#generic-error").removeClass("hidden")}).fail(function(e){$("#register-submit").prop("disabled",!1).find("i").removeClass("fa-spinner fa-spin"),$("#generic-error").removeClass("hidden")})}function W(){var e=$("#login-form").serialize();$.post({url:ao+"/login",cache:!1,xhrFields:{withCredentials:!0},data:e}).done(function(e){if("string"==typeof e.message&&"success"===e.message)return void window.location.reload();$("#login-submit").prop("disabled",!1).find("i").removeClass("fa-spinner fa-spin"),$("#generic-error").removeClass("hidden")}).fail(function(e){$("#login-submit").prop("disabled",!1).find("i").removeClass("fa-spinner fa-spin"),$("#generic-error").removeClass("hidden")})}function X(){var e=$("#confirmation-resend-form").serialize();$.post({url:ao+"/confirmation-resend",cache:!1,xhrFields:{withCredentials:!0},data:e}).done(function(e){if("string"==typeof e.message&&"success"===e.message)return void $("#register-success-submit").find("i").removeClass("fa-repeat-alt").addClass("fa-check");$("#generic-error").removeClass("hidden")}).fail(function(){$("#generic-error").removeClass("hidden")})}function Q(e,t){$("#recaptchaContainer").remove(),$('<div id="recaptchaContainer"></div>').appendTo("body"),T(window.captchaSrc,window.captchaKey,function(t){void 0!==t&&""!==t||Y.log("upload overlay - captcha token empty"),e()},t)}function Z(e,t,o){Ie(t),Ie(o),ke(o,"fileListSelector","file input selector missing"),he(1===$(o.fileListSelector).length,"could not find file input element"),he("oc"===e||"sat"===e,"invalid ui type"),this._uploader=t,this._type=e,this._apiHelper=this._uploader.getApiHelper(),this.oldBitrates=[],this.fileListSelector=o.fileListSelector,this.showPasswordOnlyForSingleInput=!0===o.showPasswordOnlyForSingleInput,this.showFailedInput=!1!==o.showFailedInput;var r=this,i=function(e,t,o){r.callback(e,t,o)};this._uploader.registerInputEventCallback(i),0!==this._uploader.getInputList().getNumberOfAllInputs()&&Y.log("qgMultiUpload ui started with a non-empty job")}function K(e){var t={};return window.location.href.replace(location.hash,"").replace(/[?&]+([^=&]+)=?([^&]*)?/gi,function(e,o,r){t[o]=r!==undefined?r:""}),e?t[e]?t[e]:null:t}var Y={addLogData:function(e,t){try{window.qgLogger.addLogData(e,t)}catch(o){}},log:function(e,t){try{window.qgLogger.log(e,t)}catch(o){}},debug:function(e,t){try{window.qgLogger.debug(e,t)}catch(o){}},info:function(e,t){try{window.qgLogger.info(e,t)}catch(o){}},notice:function(e,t){try{window.qgLogger.notice(e,t)}catch(o){}},warning:function(e,t){try{window.qgLogger.warning(e,t)}catch(o){}},error:function(e,t){try{window.qgLogger.error(e,t)}catch(o){}},critical:function(e,t){try{window.qgLogger.critical(e,t)}catch(o){}}},ee=function(){try{if(!e())return!1;return!!(window.File&&window.FileReader&&window.FileList)}catch(t){}return!1},te=function(){try{return!!("XMLHttpRequest"in window&&"withCredentials"in new XMLHttpRequest)}catch(e){}return!1},oe=!1,re=function(){var e=te();return e||oe||(oe=!0,Y.log("qgCapabilities - no cors")),e},ie=!1,ne=function(){var e=!1;try{e="string"==typeof $("#target").val()}catch(t){}return e||ie||(ie=!0,Y.log("qgCapabilities - no target")),e},ae=!1,se=function(){var e=ee();return e||ae||(ae=!0,Y.log("qgCapabilities no file api")),e},le=!1,de=function(){var t=e();return t||le||(le=!0,Y.log("qgCapabilities no blob")),t},ue=!1,pe=function(){var e=!1,t="not serialized";try{if("string"==typeof(t=$('<form><input id="test" name="test_name" value="test_value"/></form>').serialize())){var o=-1!==t.indexOf("test_name"),r=-1!==t.indexOf("test_value"),i=-1!==t.indexOf("=");e=o&&r&&i}}catch(n){t="exception happened"}return e||ue||(ue=!0,Y.log("qgCapabilities no jquery serialize",t)),e},ce=function(){return re&&de()&&se()&&pe()},fe={supportsCors:re,supportsTarget:ne,supportsFileApi:se,supportsBlob:de,supportsJquerySerialize:pe,isModernBrowser:ce},ge=function(e,t){return"string"==typeof t?"qgAssert: "+t:"qgAssert: "+e},he=function(e,t){if(!Ee(e))throw new Error(ge("value is not true",t))},ve=function(e,t){if(!Ne(e))throw new Error(ge("value is not false",t))},me=function(e,t){if(!Te(e))throw new Error(ge("value is not null",t))},be=function(e,t){if(!ze(e))throw new Error(ge("value is null",t))},_e=function(e,t){if(!je(e))throw new Error(ge("value is not a boolean",t))},ye=function(e,t){if(je(e))throw new Error(ge("value is a boolean",t))},we=function(e,t){if(!De(e))throw new Error(ge("value is not a function",t))},Ie=function(e,t){if(!Ae(e))throw new Error(ge("value is not an object",t))},Ce=function(e,t){if(!Pe(e))throw new Error(ge("value is not an array",t))},xe=function(e,t){if(Pe(e))throw new Error(ge("value is an array",t))},qe=function(e,t){if(!Je(e))throw new Error(ge("value is not a number",t))},Se=function(e,t){if(!He(e))throw new Error(ge("value is not a string",t))},$e=function(e,t){var o="value is not a uuid4";if("string"==typeof t&&(o=t),Se(e,o),!Re(e))throw new Error(ge(t))},Oe=function(e,t){if(!He(e))throw new Error(ge("value is not a string",t));if(Me(e))throw new Error(ge("value is an empty string",t))},Fe=function(e,t,o){if(Ce(e,o),qe(t,o),!Be(e,t))throw new Error(ge("array does not have index",o))},ke=function(e,t,o){if(!Ve(e,t))throw new Error(ge("object does not have key: "+t,o))},Ue=function(e){return"[object Array]"===Object.prototype.toString.call(e)},je=function(e){return"boolean"==typeof e},De=function(e){return"function"==typeof e},Ae=function(e){return"object"==typeof e&&null!==e},Pe=function(e){return Array.isArray?Array.isArray(e):Ue(e)},Je=function(e){return"number"==typeof e},He=function(e){return"string"==typeof e},Re=function(e){return!!He(e)&&/^[0-9A-F]{8}-[0-9A-F]{4}-[4][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i.test(e)},Ee=function(e){return Boolean(e)},Ne=function(e){return!Boolean(e)},Te=function(e){return null===e},ze=function(e){return null!==e},Me=function(e){return He(e)&&""===e},Le=function(e){return He(e)&&""!==e},Be=function(e,t){return Ce(e),qe(t),"undefined"!=typeof e[t]},Ge=function(e,t){Ce(e);for(var o=e.length,r=0;r<o;r++)if(t===e[r])return!0;return!1},Ve=function(e,t){return Ie(e),be(t),e.hasOwnProperty(t)},We=function(e){if(!t(e))throw new Error(ge("invalid raw job object"))},Xe=function(e){if(!o(e))throw new Error(ge("invalid raw input info"))},Qe=function(e){if(!i(e))throw new Error(ge("invalid input status (uploader)"))},Ze=function(e){if(!n(e))throw new Error(ge("invalid input status (api)"))},Ke=function(e){if(!a(e))throw new Error(ge("invalid input type"))},Ye=function(e){if(!l(e))throw new Error(ge("invalid input event"))},et=function(e){if(!s(e))throw new Error(ge("invalid global event"))},tt=function(e){if(!d(e))throw new Error(ge("invalid fileuploadconfig"))},ot=["global-event-job-create-start","global-event-job-create-done","global-event-job-create-fail","global-event-too-many-inputs","global-event-input-too-large","global-event-job-too-large","global-event-youtube-forbidden"],rt="input-event-start-loading",it=["input-event-queued","input-event-start-submitting",rt,"input-event-done","input-event-fail","input-event-password-missing","input-event-upload-canceled","input-event-deleted","input-event-upload-progress"],nt="failed",at="canceled",st=["ready",nt,"downloading",at],lt="input-status-queued",dt=[lt,"input-status-submitting-to-api","input-status-loading","input-status-done","input-status-password-missing","input-status-deleting","input-status-deleted","input-status-failed"],ut=function(e){return Qe(e),e!==lt&&("input-status-deleted"!==e&&"input-status-failed"!==e)},pt=["type-external-url","type-upload","type-gdrive","type-input-id","type-dropbox"];u.prototype.getType=function(){return Ke(this._type),this._type},u.prototype.getLocalId=function(){return this._localId},u.prototype.setLocalId=function(e){return qe(e),he(e>=0),this._localId=e,this},u.prototype.getCallback=function(){return this._callback},u.prototype.setCallback=function(e){return we(e),this._callback=e,this},u.prototype.getName=function(){return this._name},u.prototype.setName=function(e){return Se(e),this._name=e,this},u.prototype.getSize=function(){return this._size},u.prototype.setSize=function(e){return qe(e),he(e>=0),this._size=e,this},u.prototype.getInputId=function(){return this._inputId},u.prototype.setInputId=function(e){return $e(e),this._inputId=e,this},u.prototype.getStatus=function(){return this._status},u.prototype.setStatus=function(e){return Qe(e),this._status=e,this},u.prototype.setUploadData=function(e){return he("type-upload"===this._type),this._uploadData=e,this},u.prototype.getUploadData=function(){return he("type-upload"===this._type),be(this._uploadData),this._uploadData},u.prototype.isInApi=function(){return ut(this._status)},u.prototype.isQueued=function(){return this._status===lt},u.prototype.isSubmitting=function(){return"input-status-submitting-to-api"===this._status},u.prototype.isLoading=function(){return"input-status-loading"===this._status},u.prototype.isDone=function(){return"input-status-done"===this._status},u.prototype.isPasswordMissing=function(){return"input-status-password-missing"===this._status},u.prototype.isDeleting=function(){return"input-status-deleting"===this._status},u.prototype.isFileUploading=function(){return"type-upload"===this._type&&"input-status-loading"===this._status},u.prototype.isRemoteInputDownloading=function(){return"type-upload"!==this._type&&"input-status-loading"===this._status},p.prototype.register=function(e){we(e),this.listener.push(e)},p.prototype.dispatch=function(e,t,o,r){if(!Le(e))return void Y.log("eventhandler fail","event is not a string");var i=this.listener;$.each(i,function(i,n){try{n(e,t,o,r)}catch(a){Y.log("eventhandler exception",a)}})};var ct=function(){var e=window.location;return e.origin?e.origin:e.protocol+"//"+e.hostname+(e.port&&":"+e.port)};c.prototype.isValid=function(){return this._isValid},c.prototype.getId=function(){return he(this._isValid),this._data.id},c.prototype.getConversionId=function(){he(this._isValid);try{return this._data.conversion[0].id}catch(e){}return null},c.prototype.getConversionTarget=function(){he(this._isValid);try{return this._data.conversion[0].target}catch(e){}return null},c.prototype.getToken=function(){return he(this._isValid),this._data.token},c.prototype.getServer=function(){return he(this._isValid),this._data.server},c.prototype.getUploadUrl=function(){return he(this._isValid),this.getServer()+"/upload-file/"+this.getId()},c.prototype.getUploadUrlBase64=function(){return he(this._isValid),this.getServer()+"/upload-base64/"+this.getId()},c.prototype.getFallbackUploadUrl=function(){he(this._isValid);var e=this.getServer().match(/^[^:]*:\/\/([^.]+)\.([^\/]+)(\/.*)$/);if(null===e)return Y.error("Can not create fallback upload url",this.getServer()),this.getUploadUrl();var t=e[1],o=e[3];return ct()+"/upload-redirect/"+t+o+"/upload-file/"+this.getId()},c.prototype.getInput=function(e){he(this._isValid),$e(e);var t=null;return $.each(this._data.input,function(o,r){r.id===e&&(t=r)}),t},c.prototype.getInputs=function(){return he(this._isValid),this._data.input},c.prototype.getInputError=function(e){he(this._isValid),$e(e);var t=null;return $.each(this._data.errors,function(o,r){r.hasOwnProperty("id_source")&&r.id_source===e&&(t=r)}),t},c.prototype.getInputWarning=function(e){he(this._isValid),$e(e);var t=null;return $.each(this._data.warnings,function(o,r){r.hasOwnProperty("id_source")&&r.id_source===e&&(t=r)}),t},c.prototype.isInputReady=function(e){return he(this._isValid),$e(e),"ready"===this.getInput(e).status},c.prototype.isInputDownloading=function(e){return he(this._isValid),$e(e),"downloading"===this.getInput(e).status},c.prototype.getRawJobInfo=function(){return he(this._isValid),this._data};var ft="api-error-connection-problem",gt="api-error-file-too-large",ht="api-error-youtube-forbidden",vt="api-error-payment-required",mt="api-error-unexpected-job-status",bt="api-error-too-many-retries",_t="api-error-unknown",yt=["api-error-broken-server-response",ft,"api-error-try-reload","api-error-EXCEPTION","api-error-invalid-api-key","api-error-invalid-conversion-options","api-error-job-can-not-be-mofified",gt,"uploader-error-too-many-inputs",ht,"uploader-error-no-upload-server","api-error-overuse",vt,mt,bt,_t,"api-error-not-implemented","api-error-captcha-error","api-error-captcha-required"],wt=function(e){return!!Le(e)&&Ge(yt,e)},It=function(e){if(!wt(e))throw new Error(ge("not valid apiError"))};f.prototype.reset=function(){ve(this._isCreating),this._jobInfoHelper=null,this._isJobCreationFailed=!1,this._isCreating=!1,this._isUploadServerReachable=!0},f.prototype.initFromExistingJob=function(e){me(this._jobInfoHelper),ve(this._isCreating),$e(e),this.reset();var t=$.Deferred(),o=this;return o._isCreating=!0,this._api.getJobInfo(e).done(function(e){o._jobInfoHelper=new c(e),t.resolve(e),o._isCreating=!1}).fail(function(e){o._isJobCreationFailed=!0,t.reject(e),o._isCreating=!1}),t},f.prototype.create=function(e){me(this._jobInfoHelper),ve(this._isCreating),this.reset();var t=$.Deferred(),o=this;return o._isCreating=!0,this._api.createJob(e).done(function(e){o._jobInfoHelper=new c(e),t.resolve(e),o._isCreating=!1}).fail(function(e){It(e),o._isJobCreationFailed=!0,t.reject(e),o._isCreating=!1}),t},f.prototype.createWithServerCheck=function(e){me(this._jobInfoHelper),ve(this._isCreating),this.reset();var t=$.Deferred(),o=this;return o._isCreating=!0,this._api.createJobWithUploadServerCheck(e,2).done(function(e,r){o._jobInfoHelper=new c(e),o._isCreating=!1,o._isUploadServerReachable=r,t.resolve(e)}).fail(function(e){It(e),o._isJobCreationFailed=!0,o._isCreating=!1,t.reject(e)}),t},f.prototype.isCreated=function(){return null!==this._jobInfoHelper},f.prototype.isCreating=function(){return this._isCreating},f.prototype.isFailed=function(){return this._isJobCreationFailed},f.prototype.isUploadServerReachable=function(){return this._isUploadServerReachable},f.prototype.getId=function(){return ve(this._isJobCreationFailed),null===this._jobInfoHelper?null:this._jobInfoHelper.getId()},f.prototype.getConversionId=function(){return ve(this._isJobCreationFailed),this._jobInfoHelper.getConversionId()},f.prototype.getConversionTarget=function(){return ve(this._isJobCreationFailed),this._jobInfoHelper.getConversionTarget()},f.prototype.getUploadToken=function(){return ve(this._isJobCreationFailed),this._jobInfoHelper.getToken()},f.prototype.getServerUrl=function(){return ve(this._isJobCreationFailed),this._jobInfoHelper.getServer()},f.prototype.getUploadUrl=function(){return ve(this._isJobCreationFailed),this._jobInfoHelper.getUploadUrl()},f.prototype.getFallbackUploadUrl=function(){return ve(this._isJobCreationFailed),this._jobInfoHelper.getFallbackUploadUrl()},f.prototype.getJobInfo=function(){ve(this._isJobCreationFailed),be(this._jobInfoHelper);var e=$.Deferred(),t=this;return this._api.getJobInfo(t.getId()).done(function(o){We(o),t._jobInfoHelper=new c(o),e.resolve(o)}).fail(function(t){It(t),e.reject(t)}),e},f.prototype.getCachedJobInfo=function(){ve(this._isJobCreationFailed),be(this._jobInfoHelper);var e=$.Deferred(),t=this;return this._api.getCachedJobInfo(t.getId()).done(function(o){We(o),t._jobInfoHelper=new c(o),e.resolve(o)}).fail(function(t){It(t),e.reject(t)}),e},f.prototype.getRawJobInfo=function(){return ve(this._isJobCreationFailed),this._jobInfoHelper.getRawJobInfo()},f.prototype.waitForRemoteInput=function(e){var t=this._jobInfoHelper.getId();return this._api.waitForRemoteInput(t,e)};var Ct=60,xt=function(e,t){Ce(e),we(t);var o=0;return $.each(e,function(e,r){t(r)&&o++}),o};g.prototype._assertThatInputExists=function(e){Fe(this._inputs,e)},g.prototype.getInput=function(e){return qe(e),this._assertThatInputExists(e),this._inputs[e]},g.prototype.getInputs=function(){return this._inputs},g.prototype.addInput=function(e){var t=this._inputs.length;return e.setLocalId(t),this._inputs.push(e),t},g.prototype.isInputLimitReached=function(){var e=this.getNumberOfInputsInApi();return ve(e>this._maxNumberOfInputs),e>=this._maxNumberOfInputs},g.prototype.getNumberOfAllInputs=function(){return this._inputs.length},g.prototype.getNumberOfQueuedInputs=function(){var e=function(e){return e.isQueued()};return xt(this._inputs,e)},g.prototype.getNumberOfInputsInApi=function(){var e=function(e){return e.isInApi()};return xt(this._inputs,e)},g.prototype.getNumberOfDoneInputs=function(){var e=function(e){return e.isDone()};return xt(this._inputs,e)},g.prototype.getNumberOfDeletingInputs=function(){var e=function(e){return e.isDeleting()};return xt(this._inputs,e)},g.prototype.getNumberOfActiveFileUploads=function(){var e=function(e){return e.isFileUploading()};return xt(this._inputs,e)},g.prototype.getNumberOfSubmittingInputs=function(){var e=function(e){return e.isSubmitting()};return xt(this._inputs,e)},g.prototype.getNumberOfLoadingInputs=function(){var e=function(e){return e.isLoading()};return xt(this._inputs,e)},g.prototype.getNumberOfActiveRemoteInputsDownloading=function(){var e=function(e){return e.isRemoteInputDownloading()};return xt(this._inputs,e)},g.prototype.getNumberOfPasswordMissing=function(){var e=function(e){return"input-status-password-missing"===e.getStatus()};return xt(this._inputs,e)},g.prototype.getBytesInJob=function(){var e=0,t=function(t,o){(o.isLoading()||o.isDone()||o.isPasswordMissing())&&(e+=o.getSize())};return $.each(this._inputs,t),e},h.prototype.add=function(e){Se(e);var t=this._uploader,o=function(o){var r=$.Deferred(),i=t.getJob().getId();if(t.getInput(o).setStatus("input-status-submitting-to-api"),t.getInput(o).setName(e),t.dispatchInputEvent("input-event-start-submitting",o),""===e.trim()){var n=new k(_t);return t.failInput(o,n),r.resolve(),r}return t.getApiHelper().addExternalUrl(i,e).done(function(e){Xe(e);var i=e.id;t.getInput(o).setInputId(i),t.getInput(o).setStatus("input-status-loading"),t.dispatchInputEvent(rt,o),t.waitForRemoteInput(o),r.resolve()}).fail(function(e){It(e);var i=new k(e);t.failInput(o,i),r.resolve()}),r},r=new u("type-external-url");r.setName(e).setCallback(o),this._uploader._queueInput(r)},m.prototype.add=function(){if(!window.hasOwnProperty("Dropbox"))return Y.log("qgMultiUpload dropbox fail","dropbox JS missing"),void alert("Dropbox could not be initialized, please try again later!");var e=this._uploader,t=this._config,o=function(e){$.each(e,function(e,t){var o=t.link,i=0,n="Dropbox";t.hasOwnProperty("bytes")&&"number"==typeof t.bytes&&(i=t.bytes),t.hasOwnProperty("name")&&(n=t.name),r(o,i,n)})},r=function(o,r,i){var n=function(n){var a=$.Deferred();e.getInput(n).setName(i),e.getInput(n).setSize(r);var s=e.getBytesInJob()+r;if(s>t.maxFileSize){var l=new k(gt);return l.size=s,Y.log("qgMultiUpload dropbox fail",{info:"file too large",filename:i,file_size:r,max_file_size:t.maxFileSize}),e.failInput(n,l),e.dispatchGlobalEvent("global-event-input-too-large"),a.resolve()}var d=e.getJob().getId();return e.getInput(n).setStatus("input-status-submitting-to-api"),e.dispatchInputEvent("input-event-start-submitting",n),e.getApiHelper().addExternalUrl(d,o).done(function(t){Xe(t);var o=t.id;e.getInput(n).setInputId(o),e.getInput(n).setStatus("input-status-loading"),e.dispatchInputEvent(rt,n),e.waitForRemoteInput(n),a.resolve()}).fail(function(t){It(t);var o=new k(t);e.failInput(n,o),a.resolve()}),a},a=new u("type-dropbox");a.setName(i).setSize(r).setCallback(n),e._queueInput(a)},i={success:o,linkType:"direct",multiselect:!0};Dropbox.choose(i)};var qt=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},St=function(e){if(!Ae(e))return!1;var t=e.hasOwnProperty("password_protected"),o=e.hasOwnProperty("password_valid"),r=e.hasOwnProperty("unsupported_encryption"),i=e.hasOwnProperty("pdf_has_user_password"),n=e.hasOwnProperty("pdf_has_owner_password"),a=e.hasOwnProperty("pdf_password_valid");if(!o&&!t)return!1;if(t&&!1===e.password_protected)return i&&!0===e.pdf_has_user_password&&Y.error("password helper info","password fields broken: "+JSON.stringify(e)),n&&!0===e.pdf_has_owner_password&&Y.error("password helper info","password fields broken: "+JSON.stringify(e)),!1;if(r&&!0===e.unsupported_encryption)return!1;if(!o||!t)return Y.error("password helper info","password fields broken: "+JSON.stringify(e)),!1;if(!0!==e.password_protected&&!1!==e.password_protected&&Y.error("password helper info","password_protected not a boolean value: "+JSON.stringify(e)),!0!==e.password_protected)return!1;if(!n&&!i&&!a)return!(!0===e.password_valid);return n&&i&&a?e.password_valid!==e.pdf_password_valid?(Y.error("password helper info","pdf password valid inconsistent state: "+JSON.stringify(e)),!1):!0===e.pdf_has_user_password&&!e.pdf_password_valid:(Y.error("password helper info","pdf password fields missing: "+JSON.stringify(e)),!1)};b.prototype.getCurrentRetry=function(){return this._currentRetry},b.prototype.getSuccessfullChunks=function(){return this._sucessfulChunks},b.prototype.getFailedChunks=function(){return this._failedChunks},b.prototype.handleChunkSuccess=function(){this._currentRetry=0,this._sucessfulChunks++},b.prototype.handleChunkFail=function(){this._currentRetry++,this._failedChunks++},b.prototype.isAllowedToRetry=function(){return this._currentRetry<=this._maxRetries},b.prototype.getTimeOutForNextChunk_s=function(){var e=2*this._currentRetry;return e>this._maxTimeOut_s?this._maxTimeOut_s:e},b.prototype.getTimeOutForNextChunk_ms=function(){return 1e3*this.getTimeOutForNextChunk_s()},I.prototype.increaseChunkSpeed=function(){this._limitSpeed(++this._speedModifier)},I.prototype.resetChunkSpeed=function(){this._speedModifier=1},I.prototype.getDynamicChunkSize=function(e){try{var t=e.progress();if(0===t.loaded){var o=this._baseChunkSize;return e.pgRetryHandler.getCurrentRetry()>0&&(o=this._minChunkSize),o}if(1===this._speedModifier)return this._minChunkSize;var r=parseInt(t.bitrate)*this._speedModifier;return this._limitChunk(r)}catch(i){return this._baseChunkSize}},I.prototype._limitChunk=function(e){return Math.max(this._minChunkSize,Math.min(e,this._maxChunkSize))},I.prototype._limitSpeed=function(e){this._speedModifier=Math.max(1,Math.min(e,this._maxSpeedModifier))},q.prototype._processFileUploadAdd=function(e,t){var o="file";try{Le(t.files[0].name)&&(o=t.files[0].name)}catch(p){}t.pgInitialName=o;var r=0;try{Je(t.files[0].size)&&(r=t.files[0].size)}catch(p){}t.pgInitialSize=r;var i=0;try{Je(t.files[0].lastModified)&&(i=t.files[0].lastModified)}catch(p){}if("file"===o||0===r)try{var n="name: "+o+" size: "+r;Y.log("qgMultiUpload fileUpload info incorrect file data",n)}catch(p){}var a=this._uploader,s=this._config,l=function(e){var n=$.Deferred();a.getInput(e).setName(o),a.getInput(e).setSize(r);var l=a.getBytesInJob()+r;if(l>s.maxFileSize){Y.log("qgMultiUpload fileUpload fail file too large",{info:"file too large",filename:o,total_size:l,file_size:r,max_file_size:s.maxFileSize});var d=new k(gt);return d.size=l,a.failInput(e,d),a.dispatchGlobalEvent("global-event-input-too-large"),n.resolve()}var u=a.getJob();t.url=u.getUploadUrl(),s.enableUploadFallback&&!u.isUploadServerReachable()&&(Y.log("qgMultiUpload fileUpload use upload fallback"),t.url=u.getFallbackUploadUrl()),t.pgLocalId=e,a.getInput(e).setStatus("input-status-loading"),a.dispatchInputEvent(rt,e),t.headers={"X-Oc-Upload-Uuid":qt(),"X-Oc-Token":a.getJob().getUploadToken()},t.pgRetryHandler=new b;var p="file name: "+o+" file size: "+r+" file last modified: "+i;return Y.log("qgMultiUpload fileUpload start",{info:p}),t.submit(),n.resolve(),n},d=new u("type-upload");d.setCallback(l).setSize(r).setName(o).setUploadData(t),a._queueInput(d)},q.prototype._processFileUploadSubmit=function(e,t){return!0},q.prototype._processFileUploadDone=function(e,t){if("string"==typeof t.result){Y.log("qgMultiUpload fileUpload info",{info:"sever response was not parsed by browser",server_response:JSON.stringify(t.result)});try{t.result=JSON.parse(t.result)}catch(u){Y.log("qgMultiUpload fileUpload fail",{info:"server response could not be parsed as JSON",server_response:JSON.stringify(t.result)})}}var o=t.result;if(!r(o))return Y.log("qgMultiUpload fileUpload fail - invalid response",{info:"response: "+JSON.stringify(o)}),void this._uploader.failInput(t.pgLocalId);if(!0!==o.completed)return Y.log("qgMultiUpload fileUpload fail - not completed",{info:"response: "+JSON.stringify(o)}),void this._uploader.failInput(t.pgLocalId);var i=t.pgLocalId,n=o.id.input;this._uploader.getInput(i).setInputId(n);var a=t.files[0].name,s=t.files[0].size;this._uploader.getInput(i).setName(a),this._uploader.getInput(i).setSize(s);var l=St(o.metadata);this._config.enablePasswords&&l?(this._uploader.getInput(i).setStatus("input-status-password-missing"),this._uploader.dispatchInputEvent("input-event-password-missing",i)):(this._uploader.getInput(i).setStatus("input-status-done"),this._uploader.dispatchInputEvent("input-event-done",i)),t.pgRetryHandler.getFailedChunks()>0&&Y.log("qgMultiUpload fileUpload info",{info:"upload needed retries",input_id:n,filename:a});var d="file name: "+a+" file size: "+s;C(t.url)&&(d+=" use upload fallback: true",Y.log("qgMultiUpload fileUpload with fallback done")),Y.log("qgMultiUpload fileUpload done",{input_id:n,info:d})},q.prototype._processFileUploadFail=function(e,t){function o(){t.submit()}if(this._dynamicChunkHandler.resetChunkSpeed(),t.pgRetryHandler.handleChunkFail(),"abort"===t.errorThrown)return void Y.log("qgMultiUpload fileUpload abort",{ajax_status:t.textStatus,ajax_error:t.errorThrown});var r=!1;try{r="object"==typeof t.jqXHR.responseJSON}catch(u){}var i=null;try{i=t.jqXHR.responseJSON.error_code}catch(u){}var n=6===i,a=!r||n,s=t.pgRetryHandler.isAllowedToRetry(),l=this._uploader.getJob();if(a&&s){return this._config.enableUploadFallback&&l.isUploadServerReachable()&&0===t.uploadedBytes&&3===t.pgRetryHandler.getCurrentRetry()&&(Y.log("qgMultiUpload fileUpload switch to upload fallback"),t.url=l.getFallbackUploadUrl()),_(t),void window.setTimeout(o,t.pgRetryHandler.getTimeOutForNextChunk_ms())}y(t);var d=new k(_t);3!==i&&34!==i||(d.error=gt),this._uploader.failInput(t.pgLocalId,d)},q.prototype._processFileUploadProgress=function(e,t){var o={bitrate:t.bitrate,bytesLoaded:t.loaded,bytesTotal:t.total};this._uploader.dispatchInputEvent("input-event-upload-progress",t.pgLocalId,o)};var $t,Ot=!1,Ft=["https://www.googleapis.com/auth/drive.readonly","https://www.googleapis.com/auth/drive.install"];O.prototype.add=function(e,t,o,r){function i(){Oe(p.clientId),window.gapi.auth.authorize({client_id:p.clientId,scope:Ft,immediate:!1},a)}function n(){Ot=!0,s()}function a(e){e&&!e.error&&(l._oauthToken=e.access_token,s())}function s(){if(Ot&&l._oauthToken){Oe(p.developerKey);var e=new google.picker.View(google.picker.ViewId.DOCS);$t=(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.NAV_HIDDEN).enableFeature(google.picker.Feature.MULTISELECT_ENABLED).setOAuthToken(l._oauthToken).addView(e).addView(new google.picker.DocsUploadView).setDeveloperKey(p.developerKey).setCallback(c).build(),$t.setVisible(!0)}}if(null!==this._config.clientId&&null!==this._config.developerKey){var l=this,d=this._uploader,p=this._config,c=function(e){"undefined"!=typeof e.action&&"picked"===e.action&&"undefined"!=typeof e.docs&&$.each(e.docs,function(e,t){var o=0,r="gDrive";t.hasOwnProperty("sizeBytes")&&"number"==typeof t.sizeBytes&&(o=t.sizeBytes),t.hasOwnProperty("name")&&(r=t.name),f(l._oauthToken,r,o,t.id,t.mimeType)})},f=function(e,t,o,r,i){var n=function(n){var a=$.Deferred();d.getInput(n).setName(t),d.getInput(n).setSize(o);var s=d.getBytesInJob()+o;if(s>p.maxFileSize){Y.log("qgMultiUpload gdrive fail",{info:"file too large",filename:t,file_size:o,max_file_size:p.maxFileSize});var l=new k(gt);return l.size=s,d.failInput(n,l),d.dispatchGlobalEvent("global-event-input-too-large"),a.resolve()}var u=d.getJob().getId();return d.getInput(n).setStatus("input-status-submitting-to-api"),d.dispatchInputEvent("input-event-start-submitting",n),d.getApiHelper().addInput(u,{type:"gdrive_picker",source:r,credentials:{token:e},filename:t,content_type:i}).done(function(e){var t=e.id;d.getInput(n).setInputId(t),d.getInput(n).setStatus("input-status-loading"),d.dispatchInputEvent(rt,n),d.waitForRemoteInput(n),a.resolve()}).fail(function(e){It(e);var t=new k(e);d.failInput(n,t),a.resolve()}),a},a=new u("type-gdrive");a.setCallback(n).setName(t).setSize(o),d._queueInput(a)};if("string"==typeof e&&"string"==typeof t&&"string"==typeof o&&"string"==typeof r)return void f(t,e,0,o,r);var g=window.hasOwnProperty("gapi"),h=g&&window.gapi.hasOwnProperty("load");return g&&h?void 0===$t?void function(){window.gapi.load("auth",{callback:i}),window.gapi.load("picker",{callback:n})}():void $t.setVisible(!0):(Y.log("qgMultiUpload gdrive fail","gapi missing"),void alert("Google Drive could not be initialized, please try again later!"))}},F.prototype.add=function(e){Se(e);var t=this._uploader,o=function(o){var r=$.Deferred(),i=t.getJob().getId();return t.getInput(o).setStatus("input-status-submitting-to-api"),t.getInput(o).setName(e),t.dispatchInputEvent("input-event-start-submitting",o),t.getApiHelper().addInputId(i,e).done(function(e){Xe(e);var i=e.id;t.getInput(o).setInputId(i),t.getInput(o).setStatus("input-status-loading"),t.dispatchInputEvent(rt,o),t.waitForRemoteInput(o),r.resolve()}).fail(function(e){It(e);var i=new k(e);t.failInput(o,i),r.resolve()}),r},r=new u("type-input-id");r.setCallback(o).setName(e),this._uploader._queueInput(r)};var kt=function(e){if(Se(e),""===(e=e.replace(/\s/g,"")))return!1;var t="";try{var o=document.createElement("a");o.href=e,t=o.hostname,t=t.toLowerCase()}catch(r){return!1}return-1!==t.indexOf("youtube.com")||-1!==t.indexOf("youtu.be")||-1!==t.indexOf("googlevideo.com")};U.prototype._setupAddHelper=function(e){var t=new v;t.maxFileSize=this._maxFileSize,this._addDropboxHelper=new m(this,t);var o=new S;o.maxFileSize=this._maxFileSize,Le(e.gdriveClientId)&&(o.clientId=e.gdriveClientId),Le(e.gdriveDeveloperKey)&&(o.developerKey=e.gdriveDeveloperKey),this._addGdriveHelper=new O(this,o);var r=new x;r.maxFileSize=this._maxFileSize,r.enableUploadFallback=!0===e.enableUploadFallback,r.enablePasswords=!0===e.enablePasswords,r.fileUploadInputId=e.fileUploadInputId,this._addFileUploadHelper=new q(this,r),this._addInputIdHelper=new F(this),this._addExternalUrlHelper=new h(this)},U.prototype._initFromJobId=function(e){$e(e);var t=this;this._job.initFromExistingJob(e).done(function(e){var o=new c(e),r=o.getInputs();t._tryToSetSatLimitsFromJobInfo(e);var i=function(e,o){var r=o.status;if(r!==nt&&r!==at){var i="type-external-url";"upload"===o.type&&(i="type-upload"),"gdrive_picker"===o.type&&(i="type-gdrive");var n=new u(i);n.setName(o.filename).setSize(o.size).setInputId(o.id);var a=t._inputList.addInput(n);if(t.dispatchInputEvent("input-event-queued",a),"downloading"===r)return n.setStatus("input-status-loading"),t.dispatchInputEvent(rt,a),void t.waitForRemoteInput(a);if("ready"===r){var s=St(o.metadata);return void(this._enablePasswords&&s?(n.setStatus("input-status-password-missing"),t.dispatchInputEvent("input-event-password-missing",a)):(n.setStatus("input-status-done"),t.dispatchInputEvent("input-event-done",a)))}Y.error("qgMultiUpload init fail unknown input status",JSON.stringify(o))}};$.each(r,i),t._submitNextQueuedInput()}).fail(function(e){})},U.prototype.enable=function(){this._isEnabled=!0},U.prototype.disable=function(){this._isEnabled=!1},U.prototype.isEnabled=function(){return this._isEnabled},U.prototype.isEmpty=function(){var e=this.getInputList();return 0===e.getNumberOfQueuedInputs()&&0===e.getNumberOfInputsInApi()},U.prototype.isReadyToSubmit=function(e){var t=this.getInputList();return!(t.getNumberOfQueuedInputs()>0)&&(0!==t.getNumberOfInputsInApi()&&(!(t.getNumberOfSubmittingInputs()>0)&&(!(t.getNumberOfActiveFileUploads()>0)&&(!(t.getNumberOfDeletingInputs()>0)&&(!(t.getNumberOfPasswordMissing()>0)||!0===e)))))},U.prototype.isWaitingForPasswords=function(){return this.getInputList().getNumberOfPasswordMissing()>0},U.prototype.registerInputEventCallback=function(e){we(e),this._inputEventHandler.register(e)},U.prototype.dispatchInputEvent=function(e,t,o){Ye(e),this._inputEventHandler.dispatch(e,t,o)},U.prototype.registerGlobalEventCallback=function(e){we(e),this._globalEventHandler.register(e)},U.prototype.dispatchGlobalEvent=function(e,t,o){et(e),this._globalEventHandler.dispatch(e,t,o)},U.prototype.getJob=function(){return this._job},U.prototype.getInput=function(e){return this._inputList.getInput(e)},U.prototype.getInputList=function(){return this._inputList},U.prototype.getApiHelper=function(){return this._apiHelper},U.prototype._queueInput=function(e){if(this._isEnabled){var t=this._inputList.addInput(e);this.dispatchInputEvent("input-event-queued",t);var o=this.getInput(t),r=o.getSize();if(r>this._maxFileSize){Y.log("qgMultiUpload queue fail",{info:"file too large",filename:o.getName(),file_size:r,max_file_size:this._maxFileSize});var i=new k(gt);return i.size=r,this.failInput(t,i),void this.dispatchGlobalEvent("global-event-input-too-large")}if(this._blockYouTubeUrls&&"type-external-url"===o.getType()){var n=o.getName();if(kt(n)){var a=new k(ht);return this.failInput(t,a),void this.dispatchGlobalEvent("global-event-youtube-forbidden")}}if(!this._job.isCreating()){if(this._job.isCreated())return void(this._queueIsBeingProcessed||this._submitNextQueuedInput());var s=this;this.dispatchGlobalEvent("global-event-job-create-start"),this._job.createWithServerCheck(this._jobData).done(function(e){We(e),Y.addLogData("job_id",s._job.getId()),s._tryToSetSatLimitsFromJobInfo(e),s.dispatchGlobalEvent("global-event-job-create-done"),s._submitNextQueuedInput()}).fail(function(e){It(e),s._failQueuedInputs(e),s._job.reset(),s.dispatchGlobalEvent("global-event-job-create-fail")})}}},U.prototype._submitNextQueuedInput=function(){this._queueIsBeingProcessed=!0;var e=this._getNextQueuedInput();if(null===e)return void(this._queueIsBeingProcessed=!1);if(this.isInputLimitReached())return this._queueIsBeingProcessed=!1,this._failQueuedInputs("uploader-error-too-many-inputs"),this.dispatchGlobalEvent("global-event-too-many-inputs"),void(this._sentLogAboutMaxInputs||(Y.log("qgMultiUpload processQueuedInputs fail max number of inputs"),this._sentLogAboutMaxInputs=!0));var t=this._inputList.getInput(e),o=t.getSize()>this._maxFileSize,r=t.getSize()+this._inputList.getBytesInJob()>this._maxFileSize;if(o||r){Y.log("qgMultiUpload queue fail",{info:"file too large",filename:t.getName(),file_size:t.getSize(),max_file_size:this._maxFileSize});var i=new k(gt);return i.size=t.getSize(),(this.failInput(e,i),this.dispatchGlobalEvent("global-event-input-too-large"),null===this._getNextQueuedInput())?void(this._queueIsBeingProcessed=!1):void this._submitNextQueuedInput()}var n=t.getCallback(),a=this;n(t.getLocalId()).always(function(){if(null===a._getNextQueuedInput())return void(a._queueIsBeingProcessed=!1);a._submitNextQueuedInput()})},U.prototype._getNextQueuedInput=function(){var e=null,t=this._inputList.getInputs();return $.each(t,function(t,o){o.getStatus()===lt&&null===e&&(e=t)}),e},U.prototype.failInput=function(e,t){var o=new k;Ae(t)&&(ke(t,"error"),o=t),this.getInput(e).setStatus("input-status-failed"),this.dispatchInputEvent("input-event-fail",e,o)},U.prototype.deleteInput=function(e){if(this._isEnabled){var t=this.getInput(e),o=t.getStatus();if("input-status-deleting"!==o){if(!function(){return"input-status-password-missing"===o||"input-status-done"===o}())throw new Error("wrong state for being deleted");t.setStatus("input-status-deleting");var r=this;this._apiHelper.deleteInput(this._job.getId(),t.getInputId()).done(function(){t.setStatus("input-status-deleted"),r.dispatchInputEvent("input-event-deleted",e)}).fail(function(e){It(e),t.setStatus(o)})}}},U.prototype.cancelFileUpload=function(e){if(this._isEnabled){var t=this.getInput(e);if("type-upload"!==t.getType())throw new Error("only file uploads can be canceled");if("input-status-loading"!==t.getStatus())return void Y.log("qgMultiUpload fileUpload wrong state while canceling");t.getUploadData().abort(),t.setStatus("input-status-deleted"),this.dispatchInputEvent("input-event-upload-canceled",e)}},U.prototype._failQueuedInputs=function(e){var t=new k(_t);He(e)&&(It(e),t.error=e);var o=this,r=this._inputList.getInputs();$.each(r,function(e,r){r.getStatus()===lt&&o.failInput(e,t)})},U.prototype.getBytesInJob=function(){return this._inputList.getBytesInJob()},U.prototype.isInputLimitReached=function(){return this._inputList.isInputLimitReached()},U.prototype.waitForRemoteInput=function(e){var t=this.getInput(e).getInputId(),o=this;this._job.waitForRemoteInput(t).done(function(t){Xe(t),o.getInput(e).setSize(t.size),o.getInput(e).setName(t.filename);var r=St(t.metadata);o._enablePasswords&&r?(o.getInput(e).setStatus("input-status-password-missing"),o.dispatchInputEvent("input-event-password-missing",e)):(o.getInput(e).setStatus("input-status-done"),o.dispatchInputEvent("input-event-done",e))}).fail(function(t){It(t);var r=new k(t);o.failInput(e,r)})},U.prototype.addInputId=function(e){this._addInputIdHelper.add(e)},U.prototype.addExternalUrl=function(e){this._addExternalUrlHelper.add(e)},U.prototype.addExternalUrls=function(e){Ce(e);var t=this._addExternalUrlHelper;e.forEach(function(e){t.add(e)})},U.prototype.addDropbox=function(){this._addDropboxHelper.add()},U.prototype.addGdrive=function(e,t,o,r){this._addGdriveHelper.add(e,t,o,r)},U.prototype._tryToSetSatLimitsFromJobInfo=function(e){var t=null;try{t=e.sat.product.constraints}catch(i){}if(null!==t){try{var o=t.job.general.max_size;"string"==typeof o&&(o=parseInt(o)),Je(o)&&!isNaN(o)&&o>0&&(this._maxFileSize=o)}catch(i){}try{if(!this._singleInput){var r=t.job.inputs.max_count;"string"==typeof r&&(r=parseInt(r)),Je(r)&&!isNaN(r)&&r>0&&(this._inputList._maxNumberOfInputs=r)}}catch(i){}}},j.prototype.isValid=function(){return this._isValid},j.prototype.getId=function(){return he(this._isValid),this._rawData.id},j.prototype.getSize=function(){return he(this._isValid),this._rawData.size},j.prototype.getStatus=function(){return he(this._isValid),Ze(this._rawData.status),this._rawData.status},j.prototype.isFinished=function(){return he(this._isValid),"ready"===this._rawData.status},J.prototype._handlePaymentRequiredCallback=function(){if(De(this.paymentRequiredCallback))try{this.paymentRequiredCallback()}catch(e){}},J.prototype.createJob=function(e){var t=this.api;Ae(e)||(e={});var o=$.extend({},t.baseAjaxOptions);o.url="/api/jobs",o.data=e;var r=$.Deferred(),i=this;return t.ajaxWrapper.postJson(o).done(function(e,o,i){e=D(e);var n=new c(e);if(!n.isValid())return Y.log("qgApiHelper createJob fail broken response",{info:"response: "+JSON.stringify(e)}),void r.reject("api-error-broken-server-response");var a=e,s=n.getId();t.jobCache.setData(s,a),Y.addLogData("job_id",s),Y.log("qgApiHelper createJob done"),r.resolve(a)}).fail(function(e,t,o){if(402===e.status)return i._handlePaymentRequiredCallback(),void r.reject(vt);r.reject(ft)}),r},J.prototype.getJobInfo=function(e){$e(e);var t=this.api,o=$.Deferred(),r=$.extend({},t.baseAjaxOptions);r.url="/api/jobs/"+e,t.numberOfCurrentJobInfoRequests.hasOwnProperty(e)||(t.numberOfCurrentJobInfoRequests[e]=0),t.numberOfCurrentJobInfoRequests[e]++;var i=this;return t.ajaxWrapper.get(r).done(function(r,i,n){if(t.numberOfCurrentJobInfoRequests[e]--,r=D(r),!new c(r).isValid())return Y.log("qgApiHelper getJobInfo fail broken response",{info:"response: "+JSON.stringify(r)}),void o.reject("api-error-broken-server-response");var a=r;t.jobCache.setData(e,a),o.resolve(a)}).fail(function(r,n,a){if(t.numberOfCurrentJobInfoRequests[e]--,Y.log("qgApiHelper getJobInfo fail connection problem",r.status),402===r.status)return i._handlePaymentRequiredCallback(),void o.reject(vt);o.reject(ft)}),o},J.prototype.getJobInfoWithRetries=function(e,t){function o(){if(i>t)return Y.log("qgApiHelper getJobInfoWithRetries fail - no more retries"),void r.reject(bt);n.getJobInfo(e).done(function(e){r.resolve(e)}).fail(function(e){if(e===vt)return Y.log("qgApiHelper getJobInfoWithRetries getJobInfo fail - payment required",e),void r.reject(vt);i++,setTimeout(o,2e3)})}$e(e),Je(t)||(t=5),qe(t),he(t>0);var r=$.Deferred(),i=0,n=this;return o(),r},J.prototype.addInput=function(e,t){$e(e),Ie(t),xe(t),ke(t,"type");var o=this.api,r=$.Deferred(),i=$.extend({},o.baseAjaxOptions);i.url="/api/jobs/"+e+"/input",i.data=t;var n=this;return o.ajaxWrapper.postJson(i).done(function(e,t,o){if(e=D(e),!new j(e).isValid())return Y.log("qgApiHelper addJobInput fail broken response",{info:"response: "+JSON.stringify(e)}),void r.reject("api-error-broken-server-response");var i=e;Y.log("qgApiHelper addJobInput done",JSON.stringify(i)),r.resolve(i)}).fail(function(e,t,o){return Y.log("qgApiHelper addJobInput fail connection problem",e.status),0===e.status?void r.reject(ft):402===e.status?(n._handlePaymentRequiredCallback(),void r.reject(vt)):void r.reject(_t)}),r},J.prototype.addInputWithCheck=function(e,t,o){function r(){s.getJobInfoWithRetries(e,3).done(function(e){var t=e.input.length;return t===o?(Y.log("qgApiHelper addInputWithCheck retry"),void setTimeout(i,2e3)):t===o+1?(Y.log("qgApiHelper addInputWithCheck done - with retry"),void n.resolve(e.input[t-1])):(Y.log("qgApiHelper addInputWithCheck fail","wrong number of inputs"),void n.reject(_t))}).fail(function(e){Y.log("qgApiHelper addInputWithCheck fail",e),n.reject(_t)})}function i(){if(a>5)return Y.log("qgApiHelper addInputWithCheck fail - too many retries"),void n.reject(bt);s.addInput(e,t).done(function(e){n.resolve(e)}).fail(function(e){if(e===ft)return void r();Y.log("qgApiHelper addInputWithCheck fail"),n.reject(e)}),a++}$e(e),Ie(t),xe(t),ke(t,"type"),qe(o),he(o>=0);var n=$.Deferred(),a=0,s=this;return i(),n},J.prototype.addInputs=function(e,t){$e(e),Ie(t);var o=this.api,r=$.Deferred(),i=$.extend({},o.baseAjaxOptions);return i.url="/api/jobs/"+e+"/input",i.data=t,o.ajaxWrapper.postJson(i).done(function(e,o,i){e=D(e);var n,a=e;if(n=Pe(a)?a[0]:a,!new j(n).isValid())return Y.log("qgApiHelper addJobInput fail broken response",{info:"response: "+JSON.stringify(a)}),void r.reject("api-error-broken-server-response");Y.log("qgApiHelper addJobInput done",JSON.stringify(t)),r.resolve(a)}).fail(function(e,t,o){Y.log("qgApiHelper addJobInput fail connection problem",e.status),r.reject(ft)}),r},J.prototype.addConversion=function(e,t){$e(e),Ie(t);var o=this.api,r=$.Deferred(),i=$.extend({},o.baseAjaxOptions);i.url="/api/jobs/"+e+"/conversions",i.data=t;var n=this;return o.ajaxWrapper.postJson(i).done(function(e,o,i){e=D(e),Y.log("qgApiHelper addConversion done",JSON.stringify(t)),r.resolve(e)}).fail(function(e,t,o){var a=P(e);if(a){if(2===a.code)return Y.log("qgApiHelper addConversion fail - invalid conversion option",{http_status:e.status,info:"conversion options: "+JSON.stringify(i)}),void r.reject("api-error-invalid-conversion-options");if(2002===a.code)return Y.log("qgApiHelper addConversion fail - job can not be modified",{http_status:e.status,info:"conversion options: "+JSON.stringify(i)}),void r.reject("api-error-job-can-not-be-mofified")}return 0===e.status?(Y.log("qgApiHelper addConversion fail - connection problem",e.status),void r.reject(ft)):402===e.status?(Y.log("qgApiHelper addConversion fail - payment required",e.status),n._handlePaymentRequiredCallback(),void r.reject(vt)):(Y.log("qgApiHelper addConversion fail - unknown",e.status),void r.reject(_t))}),r},J.prototype.addConversionWithCheck=function(e,t){function o(){n.getJobInfoWithRetries(e,5).done(function(e){if(Pe(e.conversion)){if(0===e.conversion.length)return Y.log("qgApiHelper addConversionWithCheck retry - no conversion"),void setTimeout(r,2e3);if(1===e.conversion.length)return Y.log("qgApiHelper addConversionWithCheck done - after fail"),void i.resolve(e.conversion[0]);Y.log("qgApiHelper addConversionWithCheck fail - too many conversions"),i.reject(_t)}}).fail(function(e){Y.log("qgApiHelper addConversionWithCheck fail - fail in getjobinfo"),i.reject(_t)})}function r(){if(a>5)return Y.log("qgApiHelper addConversionWithCheck fail - too many retries"),void i.reject(bt);n.addConversion(e,t).done(function(e){i.resolve(e)}).fail(function(e){if(e===ft||e===_t)return void o();i.reject(e)}),a++}$e(e);var i=$.Deferred(),n=this,a=0;return r(),i},J.prototype.startJob=function(e,t){$e(e);var o=$.Deferred();return o.reject("api-error-not-implemented"),o},J.prototype.deleteInput=function(e,t){$e(e),$e(t);var o=this.api,r=$.Deferred(),i=$.extend({},o.baseAjaxOptions);return i.url="/api/jobs/"+e+"/input/"+t+"/delete",i.data=$.extend({},o.baseData),o.ajaxWrapper.postJson(i).done(function(e,o,i){e=D(e),Y.log("qgApiHelper deleteInput done",t),r.resolve(e)}).fail(function(e,t,o){Y.log("qgApiHelper deleteInput fail connection problem",e.status),r.reject(ft)}),r},J.prototype.setPassword=function(e,t,o){$e(e),$e(t);var r=$.Deferred(),i=this.api,n=$.extend({},i.baseData,{credentials:{decrypt_password:o}}),a=$.extend({},i.baseAjaxOptions);return a.url="/api/jobs/"+e+"/input/"+t+"/patch",a.data=n,i.ajaxWrapper.postJson(a).done(function(e,o,i){e=D(e),Y.log("qgApiHelper set password done",t),r.resolve(e)}).fail(function(e,t,o){Y.log("qgApiHelper set password fail connection problem",e.status),r.reject(ft)}),r},H.prototype.createJob=function(e){var t=this.api;Ae(e)||(e={});var o=$.extend({},t.baseAjaxOptions);o.url=this.baseUrlApi+"/api/jobs",o.data=$.extend({},t.baseData,e);var r=Date.now(),i=$.Deferred();return t.ajaxWrapper.post(o).done(function(e,n,a){e=D(e);var s=A(e);if(s){var l="qgApiHelper createJob fail error code",d=_t;return 1===s.code&&(l="qgApiHelper createJob fail overuse",d="api-error-overuse"),1013===s.code&&(l="qgApiHelper createJob Csrf mismatch",d="api-error-try-reload"),Y.log(l,{info:"data: "+JSON.stringify(o.data)+" | response: "+JSON.stringify(e)}),void i.reject(d)}var u=e,p=new c(u);if(!p.isValid())return Y.log("qgApiHelper createJob fail broken response",{info:"response: "+JSON.stringify(u)}),void i.reject("api-error-broken-server-response");var f=p.getId();t.jobCache.setData(f,u),Y.addLogData("job_id",f);var g=(Date.now()-r)/1e3;Y.log("qgApiHelper createJob done",{duration_s:g}),i.resolve(u)}).fail(function(e,t,o){Y.log("qgApiHelper createJob fail connection problem",e.status),i.reject(ft)}),i},H.prototype.getJobInfo=function(e){$e(e);var t=this.api,o=$.extend({},t.baseAjaxOptions);o.url=this.baseUrlApi+"/api/jobs/"+e,o.data=$.extend({},t.baseData);var r=$.Deferred();return t.numberOfCurrentJobInfoRequests.hasOwnProperty(e)||(t.numberOfCurrentJobInfoRequests[e]=0),t.numberOfCurrentJobInfoRequests[e]++,t.ajaxWrapper.get(o).done(function(i,n,a){if(t.numberOfCurrentJobInfoRequests[e]--,i=D(i),A(i))return Y.log("qgApiHelper getJobInfo fail error code",{info:"data: "+JSON.stringify(o.data)+" | response: "+JSON.stringify(i)}),void r.reject(_t);var s=i;if(!new c(s).isValid())return Y.log("qgApiHelper getJobInfo fail broken response",{info:"response: "+JSON.stringify(s)}),void r.reject("api-error-broken-server-response");t.jobCache.setData(e,s),r.resolve(s)}).fail(function(o,i,n){t.numberOfCurrentJobInfoRequests[e]--,Y.log("qgApiHelper getJobInfo fail connection problem",o.status),r.reject(ft)}),r},H.prototype.getJobInfoWithRetries=function(e,t){function o(){if(i>t)return Y.log("qgApiHelper getJobInfoWithRetries fail - no more retries"),void r.reject(bt);n.getJobInfo(e).done(function(e){r.resolve(e)}).fail(function(e){if(e===vt)return Y.log("qgApiHelper getJobInfoWithRetries getJobInfo fail - payment required",e),void r.reject(vt);i++,setTimeout(o,2e3)})}$e(e),Je(t)||(t=5),qe(t),he(t>0);var r=$.Deferred(),i=0,n=this;return o(),r},H.prototype.addInput=function(e,t){$e(e),Ie(t),xe(t),ke(t,"type");var o=this.api;t=$.extend({},o.baseData,t);var r=$.extend({},o.baseAjaxOptions);r.url=this.baseUrlApi+"/api/jobs/"+e+"/input",r.data=t;var i=Date.now(),n=$.Deferred();return o.ajaxWrapper.post(r).done(function(e,t,o){e=D(e);var a=A(e);if(a){var s="qgApiHelper addJobInput fail error code",l=_t;return 50!==a.code&&34!==a.code||(s="qgApiHelper addJobInput fail file too large",l=gt),1013===a.code&&(s="qgApiHelper addJobInput fail Csrf mismatch",l="api-error-try-reload"),Y.log(s,{info:"data: "+JSON.stringify(r.data)+" | response: "+JSON.stringify(e)}),void n.reject(l)}var d=e;if(!new j(d).isValid())return Y.log("qgApiHelper addJobInput fail broken response",{info:"response: "+JSON.stringify(d)}),void n.reject("api-error-broken-server-response");var u=(Date.now()-i)/1e3;Y.log("qgApiHelper addJobInput done",{duration_s:u}),n.resolve(d)}).fail(function(e,t,o){Y.log("qgApiHelper addJobInput fail connection problem",e.status),n.reject(ft)}),n},H.prototype.addInputWithCheck=function(e,t,o){$e(e),Ie(t),xe(t),ke(t,"type"),qe(o),he(o>=0);var r=$.Deferred();return r.reject("api-error-not-implemented"),r},H.prototype.addConversion=function(e,t){$e(e),Ie(t);var o=this.api,r=$.extend({},o.baseAjaxOptions);r.url=this.baseUrlApi+"/api/jobs/"+e+"/conversions",r.data=t;var i=$.Deferred();return o.ajaxWrapper.post(r).done(function(e,o,n){e=D(e);var a=A(e);if(a){var s="qgApiHelper addConversion fail error code",l=_t;return 1013===a.code&&(s="qgApiHelper addJobInput fail Csrf mismatch",l="api-error-try-reload"),Y.log(s,{info:"data: "+JSON.stringify(r.data)+" | response: "+JSON.stringify(e)}),void i.reject(l)}Y.log("qgApiHelper addConversion done","conversion: "+JSON.stringify(t)),i.resolve(e)}).fail(function(e,t,o){Y.log("qgApiHelper addConversion fail connection problem",e.status),i.reject(ft)}),i},H.prototype.addConversionWithCheck=function(e,t){$e(e);var o=$.Deferred();return o.reject("api-error-not-implemented"),o},H.prototype.startJob=function(e,t){$e(e);var o=this.api;void 0===t&&(t=""),Se(t);var r=$.extend({},o.baseAjaxOptions);r.url=this.baseUrlApi+"/api/jobs/"+e+"/start",r.data=t;var i=$.Deferred();return o.ajaxWrapper.post(r).done(function(e,t,o){e=D(e);var n=A(e);if(n){if(1018===e.code)return Y.log("qgApiHelper startJob done","job already started"),void i.resolve();Y.log("qgApiHelper startJob fail error code",{info:"data: "+JSON.stringify(r.data)+" | response: "+JSON.stringify(e)});var a=_t;return 1===e.code&&(a=vt),2===e.code&&(a="api-error-invalid-conversion-options"),1012===n.code&&(a="api-error-invalid-api-key"),1013===n.code&&(a="api-error-try-reload"),1017===n.code&&(a="api-error-captcha-error"),1019===n.code&&(a="api-error-captcha-required"),void i.reject(a)}Y.log("qgApiHelper startJob done"),i.resolve(e)}).fail(function(e,t,o){Y.log("qgApiHelper startJob fail connection problem",e.status),i.reject(ft)}),i},H.prototype.savePreset=function(e){var t=this.api,o=$.extend({},t.baseAjaxOptions);o.url=this.baseUrlApi+"/api/presets",o.data=e,o.maxRetries=2;var r=$.Deferred();return t.ajaxWrapper.post(o).done(function(e,t,i){if(e=D(e),A(e))return Y.log("qgApiHelper savePreset fail error code",{info:"data: "+JSON.stringify(o.data)+" | response: "+JSON.stringify(e)}),void r.reject(_t);Y.log("qgApiHelper savePreset done"),r.resolve(e)}).fail(function(e,t,o){Y.log("qgApiHelper savePreset fail connection problem",e.status),r.reject(ft)}),r},H.prototype.deleteInput=function(e,t){$e(e),$e(t);var o=this.api,r=$.extend({},o.baseAjaxOptions);r.url=this.baseUrlApi+"/api/jobs/"+e+"/input/"+t+"/delete",r.data=$.extend({},o.baseData);var i=$.Deferred();return o.ajaxWrapper.post(r).done(function(e,o,n){if(e=D(e),A(e))return Y.log("qgApiHelper deleteInput fail error code",{info:"data: "+JSON.stringify(r.data)+" | response: "+JSON.stringify(e)}),void i.reject(_t);Y.log("qgApiHelper deleteInput done","input_id: "+t),i.resolve(e)}).fail(function(e,t,o){Y.log("qgApiHelper deleteInput fail connection problem",e.status),i.reject(ft)}),i},H.prototype.setPassword=function(e,t,o){$e(e),$e(t),Se(o);var r=this.api,i=$.extend({},r.baseAjaxOptions);i.url=this.baseUrlApi+"/api/jobs/"+e+"/input/"+t+"/patch",i.data=$.extend({},r.baseData),i.data.decrypt_password=o;var n=$.Deferred();return r.ajaxWrapper.post(i).done(function(e,o,r){e=D(e);var a=A(e);if(a){var s="qgApiHelper set password - fail error code",l=_t;return 1013===a.code&&(s="qgApiHelper addJobInput fail Csrf mismatch",l="api-error-try-reload"),Y.log(s,{info:"data: "+JSON.stringify(i.data)+" | response: "+JSON.stringify(e)}),void n.reject(l)}Y.log("qgApiHelper set password - done","input_id: "+t),n.resolve(e)}).fail(function(e,t,o){Y.log("qgApiHelper set password - fail connection problem",e.status),n.reject(ft)}),n};var Ut=function(e){qe(e),e<1&&(e=1);var t=e;return t>20&&(t=20),t},jt=function(e){return qe(e),e<1&&(e=1),e<3?10:20};R.prototype.ajax=function(e){function t(){function u(t,o,r){var i=(Date.now()-f)/1e3;i>15&&d.log("qgAjaxWrapper - done - slow ajax call",{url:e.url,duration_s:i}),l.resolve(t,o,r)}function p(u,p,c){function g(t){d.log(t,{url:e.url,ajax_status:p,ajax_error:c,http_status:u.status,http_method:e.method,duration_s:h})}var h=(Date.now()-f)/1e3,v=s<o,m="timeout"===p,b=u.status>=400&&u.status<500,_=u.status>=500&&u.status<600;if(m){if(!r||!v)return g("qgAjaxWrapper - with retry - fail - timeout - final"),void l.reject(u,p,c);g("qgAjaxWrapper - with retry - fail - timeout - retry")}else if(b){if(!i||!v)return g("qgAjaxWrapper - with retry - fail - 4xx - final"),void l.reject(u,p,c);g("qgAjaxWrapper - with retry - fail - 4xx - retry")}else if(_){if(!n||!v)return g("qgAjaxWrapper - with retry - fail - 5xx - final"),void l.reject(u,p,c);g("qgAjaxWrapper - with retry - fail - 5xx - retry")}else{if(!a||!v)return g("qgAjaxWrapper - with retry - fail - other - final"),void l.reject(u,p,c);g("qgAjaxWrapper - with retry - fail - other - retry")}s+=1;var y=Ut(s);_&&(y=jt(s)),setTimeout(function(){t()},1e3*y)}function c(t,o,r){var i,n=(Date.now()-f)/1e3,a="timeout"===o,s=t.status>=400&&t.status<500,u=t.status>=500&&t.status<600;i=a?"qgAjaxWrapper - no retry - fail - timeout":s?"qgAjaxWrapper - no retry - fail - 4xx":u?"qgAjaxWrapper - no retry - fail - 5xx":"qgAjaxWrapper - no retry - fail - other",d.log(i,{url:e.url,ajax_status:o,ajax_error:r,http_status:t.status,http_method:e.method,duration_s:n}),l.reject(t,o,r)}var f=Date.now();$.ajax(e).done(u).fail(function(e,t,r){o>0?p(e,t,r):c(e,t,r)})}Ie(e);var o=0;e.hasOwnProperty("maxRetries")&&(qe(e.maxRetries),he(e.maxRetries>=0),o=e.maxRetries),e.hasOwnProperty("timeout")?(qe(e.timeout),he(e.timeout>=0)):e.timeout=59e3,!e.hasOwnProperty("method")&&e.hasOwnProperty("type")&&(e.method=e.type),e.hasOwnProperty("method")||(e.method="GET");var r=!1,i=!1,n=!0,a=!0;e.hasOwnProperty("retryTimeout")&&(_e(e.retryTimeout),r=e.retryTimeout),e.hasOwnProperty("retry400")&&(_e(e.retry400),i=e.retry400),e.hasOwnProperty("retry500")&&(_e(e.retry500),n=e.retry500),e.hasOwnProperty("retryOther")&&(_e(e.retryOther),a=e.retryOther),e.hasOwnProperty("cache")||(e.cache=!1);var s=0,l=$.Deferred(),d=this._logger;return t(),l},R.prototype.post=function(e){return e.method="POST",this.ajax(e)},R.prototype.postJson=function(e){return e.method="POST",e.contentType="application/json",e.processData=!1,"object"==typeof e.data&&(e.data=JSON.stringify(e.data)),this.ajax(e)},R.prototype.get=function(e){return e.method="GET",this.ajax(e)},E.prototype.setData=function(e,t){Oe(e),be(t),ye(t),this.data[e]={time_ms:Date.now(),data:t}},E.prototype.getData=function(e){return Oe(e),this.data.hasOwnProperty(e)?!((Date.now()-this.data[e].time_ms)/1e3>this.maxCacheTimeSeconds)&&this.data[e].data:null},E.prototype.getDataEvenIfTooOld=function(e){return Oe(e),this.data.hasOwnProperty(e)?this.data[e].data:null};var Dt=2;N.prototype.createJob=function(e){var t=this.apiHelper;try{return t.createJob(e)}catch(r){Y.log("qgApiHelper exception",r)}var o=$.Deferred();return o.reject("api-error-EXCEPTION"),o},N.prototype.createJobWithUploadServerCheck=function(e,t){function o(){n.apiHelper.createJob(e).done(function(e){r(e)}).fail(function(e){It(e),i.reject(e)})}function r(e){n.checkUploadServer(e.server).done(function(){i.resolve(e,!0)}).fail(function(r){if(a>=t){Y.log("qgApiHelper createJob info","no upload server found");return void i.resolve(e,!1)}a++;var n=1e3*a;n>1e4&&(n=1e4),setTimeout(function(){o()},n)})}Je(t)||(t=1);var i=$.Deferred(),n=this,a=0;return o(),i},N.prototype.checkUploadServer=function(e,t){Oe(e),Je(t)||(t=0);var o=e.replace(/(\/dl.*)/,"/dl/alive"),r={url:o,timeout:1e4,maxRetries:t},i=Date.now(),n=$.Deferred();return this.ajaxWrapper.get(r).done(function(e,t,o){n.resolve()}).fail(function(t,o,r){var a=e.match(/(www[^.]*)/)[0],s=(Date.now()-i)/1e3;Y.log("qgApiHelper checkUploadServer fail upload server not available",{upload_server:a,http_status:t.status,ajax_status:o,ajax_error:r,duration_s:s}),n.reject(ft)}),n},N.prototype.getJobInfo=function(e){$e(e);var t=this.apiHelper;try{return t.getJobInfo(e)}catch(r){Y.log("qgApiHelper exception",r)}var o=$.Deferred();return o.reject("api-error-EXCEPTION"),o},N.prototype.getJobInfoWithRetries=function(e,t){$e(e),Je(t)||(t=5),qe(t),he(t>0);var o=this.apiHelper;try{return o.getJobInfoWithRetries(e,t)}catch(i){Y.log("qgApiHelper exception",i)}var r=$.Deferred();return r.reject("api-error-EXCEPTION"),r},N.prototype.getCachedJobInfo=function(e){$e(e);var t=this.jobCache.getData(e);be(t),this.numberOfCurrentJobInfoRequests.hasOwnProperty(e)||(this.numberOfCurrentJobInfoRequests[e]=0);var o=this.numberOfCurrentJobInfoRequests[e]>0;if(!1===t&&!o)return this.getJobInfo(e);var r=this.jobCache.getDataEvenIfTooOld(e),i=$.Deferred();return i.resolve(r),i},N.prototype.addInput=function(e,t){$e(e),Ie(t);var o=this.apiHelper;try{return o.addInput(e,t)}catch(i){Y.log("qgApiHelper exception",i)}var r=$.Deferred();return r.reject("api-error-EXCEPTION"),r},N.prototype.addInputWithCheck=function(e,t,o){$e(e),Ie(t),qe(o),he(o>=0);var r=this.apiHelper;try{return r.addInputWithCheck(e,t,o)}catch(n){Y.log("qgApiHelper exception",n)}var i=$.Deferred();return i.reject("api-error-EXCEPTION"),i},N.prototype.addInputsWithCheck=function(e,t,o){function r(){i.addInputWithCheck(e,t[a],l).done(function(){if(a++,l++,a>=s)return void n.resolve();setTimeout(r,200)}).fail(function(e){Y.log("qgApiHelper addInputsWithCheck fail",e),n.reject(e)})}$e(e),Ce(t),he(t.length>0),qe(o),he(o>=0);var i=this,n=$.Deferred(),a=0,s=t.length,l=o;return r(),n},N.prototype.addInputs=function(e,t){$e(e);var o=this.apiHelper;try{return o.addInputs(e,t)}catch(i){Y.log("qgApiHelper exception",i)}var r=$.Deferred();return r.reject("api-error-EXCEPTION"),r},N.prototype.addInputId=function(e,t){$e(e),$e(t);var o={type:"input_id",source:t};return this.addInput(e,o)},N.prototype.addExternalUrl=function(e,t){$e(e),Oe(t);var o={type:"remote",source:t};return this.addInput(e,o)},N.prototype.addConversion=function(e,t){$e(e);var o=this.apiHelper;try{return o.addConversion(e,t)}catch(i){Y.log("qgApiHelper exception",i)}var r=$.Deferred();return r.reject("api-error-EXCEPTION"),r},N.prototype.addConversionWithCheck=function(e,t){$e(e);var o=this.apiHelper;try{return o.addConversionWithCheck(e,t)}catch(i){Y.log("qgApiHelper exception",i)}var r=$.Deferred();return r.reject("api-error-EXCEPTION"),r},N.prototype.startJob=function(e,t){$e(e);var o=this.apiHelper;try{return o.startJob(e,t)}catch(i){Y.log("qgApiHelper exception",i)}var r=$.Deferred();return r.reject("api-error-EXCEPTION"),r},N.prototype.deleteInput=function(e,t){$e(e),$e(t);var o=this.apiHelper;try{return o.deleteInput(e,t)}catch(i){Y.log("qgApiHelper exception",i)}var r=$.Deferred();return r.reject("api-error-EXCEPTION"),r},N.prototype.setPassword=function(e,t,o){$e(e),$e(t),Se(o);var r=this.apiHelper;try{return r.setPassword(e,t,o)}catch(n){Y.log("qgApiHelper exception",n)}var i=$.Deferred();return i.reject("api-error-EXCEPTION"),i},N.prototype.waitForRemoteInput=function(e,t){function o(){var e=(Date.now()-l)/1e3,t=5e3;e<10?t=1e3:e<30?t=2e3:e<60&&(t=3e3),setTimeout(n,t)}function r(o,r,i){Y.log("qgApiHelper waitForRemoteInput fail",{info:JSON.stringify(o),input_id:t,job_id:e,job_info:JSON.stringify(r),duration_s:i});var n=_t;return 50===o.code||34===o.code?n=gt:10===o.code&&(n=ht),It(n),n}function i(i){var n=(Date.now()-l)/1e3,a=new c(i),d=a.getInput(t);if(null===d)return n>10&&Y.log("qgApiHelper waitForRemoteInput info",{info:"input id missing from job",input_id:t,job_id:e,job_info:JSON.stringify(i),duration_s:n}),void o();if(a.isInputDownloading(t))return void o();if(a.isInputReady(t))return s.resolve(d),void Y.log("qgApiHelper waitForRemoteInput done",{input_id:t,job_id:e,duration_s:n});var u={code:0,message:"should never happen"},p=a.getInputError(t),f=a.getInputWarning(t);null!==p?u=p:null!==f?u=f:d.status===nt?u={code:0,message:"server response is missing input warnings and input errrors"}:d.status===at&&(u={code:0,message:"input was canceled"});var g=r(u,i,n);It(g),s.reject(g)}function n(){a.getCachedJobInfo(e).done(function(e){We(e),i(e)}).fail(function(r){if(It(r),r===vt)return void s.reject(r);Y.log("qgApiHelper waitForRemoteInput retry",{info:"error: "+r,job_id:e,input_id:t}),o()})}$e(e),$e(t);var a=this,s=$.Deferred(),l=Date.now();return n(),s},N.prototype.savePreset=function(e){var t=this.apiHelper;try{return t.savePreset(e)}catch(r){Y.log("qgApiHelper exception",r)}var o=$.Deferred();return o.reject("api-error-EXCEPTION"),o},N.prototype.waitForCompletedJob=function(e){function t(e){var t=500;return e>2e3&&(t=1e3),e>5e3&&(t=2e3),e>1e4&&(t=3e3),t}function o(){if(n>5)return void r.reject(bt);a.getJobInfoWithRetries(e,3).done(function(n){var a=Date.now()-i,s=n.status.code;if("completed"===s)return void r.resolve(n);if("failed"===s)return Y.log("qgApiHelper waitForCompletedJob - job is failed",{job_id:e}),void r.reject(mt);if(("incomplete"===s||"ready"===s)&&a>4e3)return Y.log("qgApiHelper waitForCompletedJob - job has unextected status",{job_id:e,info:"status: "+s}),void r.reject(mt);var l=t(a);setTimeout(o,l)}).fail(function(e){n++,setTimeout(o,5e3)})}var r=$.Deferred(),i=Date.now(),n=0,a=this;return o(),r};var At,Pt=function(e){return Ie(e),new N("oc",e)},Jt="#forms",Ht={},Rt=null,Et=null,Nt=!1,Tt=function(){$(".submit-button-text-start-conversion").removeClass("hidden"),$(".submit-button-text-uploading, .submit-button-text-submitting").addClass("hidden"),$(".cancel_upload").addClass("hidden")},zt=function(){$(".submit-button-text-start-conversion, .submit-button-text-submitting").addClass("hidden"),$(".submit-button-text-uploading").removeClass("hidden"),$(".cancel_upload").removeClass("hidden")},Mt=function(){$(".submit-button-text-start-conversion, .submit-button-text-uploading").addClass("hidden"),$(".submit-button-text-submitting").removeClass("hidden"),$(".cancel_upload").addClass("hidden")},Lt=function(){$(".multifile-submit-button").prop("disabled",!1)},Bt=function(){$(".multifile-submit-button").prop("disabled",!0)},Gt=function(e){var t=$.Deferred();return 0===$.trim($("#save-settings-name").val()).length?(t.resolve(),t):(Et.savePreset(e).done(function(e){t.resolve()}).fail(function(){t.resolve()}),t)},Vt=function(){Mt(),$(".cancel_upload").addClass("hidden");var e=$("#forms").serialize();e+="&conversion_id="+Rt.getJob().getConversionId(),Ht.supportTargetSwitch&&(e+="&conversion_target="+Rt.getJob().getConversionTarget()),Gt(e).then(function(){var t=Rt.getJob().getId();Et.startJob(t,e).done(function(){window.location.href=Ht.resultBase+Rt.getJob().getId()}).fail(function(e){return"api-error-try-reload"===e?(qgAlertHelper.show(qgAlertHelper.alerts.ERROR_TRY_RELOAD),void Qt()):"api-error-captcha-error"===e?($(".captcha-error").removeClass("hidden"),void Qt()):"api-error-captcha-required"===e?void T(window.captchaSrc,window.captchaKey,Vt):void(window.location.href=Ht.resultBase+Rt.getJob().getId())})})},Wt=function(){Nt=!0,$("#externalUrlInput").val(""),$("#externalUrlField").hide();var e=Rt.getInputList();(e.getNumberOfQueuedInputs()>0||e.getNumberOfActiveFileUploads()>0||e.getNumberOfSubmittingInputs()>0)&&zt(),Bt(),Rt.disable(),Xt()},Xt=function(){if(Nt){var e=Rt.getInputList();if(Rt.isEmpty())return void Qt();var t=e.getNumberOfPasswordMissing()>0&&!Rt._showPasswordOnlyForSingleInput,o=1===e.getNumberOfPasswordMissing()&&1===e.getNumberOfInputsInApi()&&Rt._showPasswordOnlyForSingleInput&&0===e.getNumberOfQueuedInputs();return t||o?(Qt(),void qgAlertHelper.show(qgAlertHelper.alerts.PASSWORD_MISSING)):Rt.isReadyToSubmit(Ht.ignoreMissingPasswords)?void Vt():void(Nt&&setTimeout(Xt,500))}},Qt=function(){Nt=!1,Tt(),Lt(),Rt.enable()},Zt=function(){if(!Nt){if(!Ht.formValidator.form())return void Qt();var e=$.trim($("#externalUrlInput").val()),t=Rt.getInputList();0===t.getNumberOfQueuedInputs()&&0===t.getNumberOfInputsInApi()&&e.length>0&&Rt.addExternalUrl(e);var o=t.getNumberOfPasswordMissing()>0&&!Rt._showPasswordOnlyForSingleInput,r=1===t.getNumberOfPasswordMissing()&&1===t.getNumberOfInputsInApi()&&Rt._showPasswordOnlyForSingleInput&&0===t.getNumberOfQueuedInputs();return o||r?(Qt(),void qgAlertHelper.show(qgAlertHelper.alerts.PASSWORD_MISSING)):0===t.getNumberOfQueuedInputs()&&0===t.getNumberOfInputsInApi()?(Qt(),void qgAlertHelper.show(qgAlertHelper.alerts.INPUT_MISSING)):void Wt()}},Kt=function(e){$("#captchaResponseToken").val(e),$(".captcha-error").addClass("hidden"),Zt()},Yt=function(e,t,o){"input-event-fail"===e&&Qt()},eo=function(e,t){Ht=t,Rt=e,Et=e.getApiHelper(),Rt.registerInputEventCallback(Yt),$(".cancel_upload").click(function(e){e.preventDefault(),e.stopPropagation(),Qt()}),window.captchaSubmit=Kt},to={submit:Zt,init:eo},oo=function(e){$("#dropboxButton").click(function(t){t.preventDefault(),t.stopPropagation();try{if(!e.isEnabled())return;e.addDropbox()}catch(t){Y.log("qgMultiUpload exception dropbox",t)}}),$("#gdriveButton").click(function(t){t.preventDefault(),t.stopPropagation();try{if(!e.isEnabled())return;e.addGdrive()}catch(t){Y.log("qgMultiUpload exception gdrive",t)}}),$(".dropzone").click(function(t){t.preventDefault(),t.stopPropagation();try{if(!e.isEnabled())return;$("#fileUploadInput").click()}catch(t){Y.log("qgMultiUpload exception fileuploader ui",t)}});var t=$(".addExampleFile");t.removeClass("hidden"),t.click(function(){try{if(!e.isEnabled())return;var t=$.trim($("#externalUrlExample").val());0===t.length&&(t="https://static.online-convert.com/example-file/raster%20image/jpeg/example.jpeg"),e.addExternalUrl(t)}catch(o){Y.log("qgMultiUpload exception example file",o)}}),$("#externalUrlButton").click(function(t){t.preventDefault(),t.stopPropagation(),e.isEnabled()&&$("#externalUrlField").toggle("fast",function(){$("#externalUrlField").is(":visible")&&$("#externalUrlInput").focus()})}),$("#externalUrlField .addUrlButton").click(function(){try{if(!e.isEnabled())return;var t=$("#externalUrlInput"),o=$.trim(t.val());if(0===o.length)return;e.addExternalUrl(o),t.val("")}catch(r){Y.log("qgMultiUpload exception external url",r)}}),$("#externalUrlField .cancelButton").click(function(){$("#externalUrlInput").val(""),$("#externalUrlField").hide()}),$("#externalUrlField #externalUrlInput").keydown(function(e){13==e.keyCode&&$("#externalUrlField .addUrlButton").trigger("click")}),$(".multifile-submit-button").click(function(e){if(e.preventDefault(),e.stopPropagation(),!0===window.useCaptchaSubmit)try{var t=0,o=function(){if("undefined"==typeof grecaptcha||"undefined"==typeof grecaptcha.execute)return t>=25?void Y.log("qgMultiUpload captcha - recaptcha not loaded"):(t++,void setTimeout(o,200));grecaptcha.execute()};return void o()}catch(e){return void Y.log("qgMultiUpload exception submit captcha",e)}try{to.submit()}catch(e){Y.log("qgMultiUpload exception submit",e)}}),$("#forms").attr("action","")},ro=null,io=!1,no="",ao="",so=0,lo=!1,uo=null,po=null,co=function(){fo(),po.removeClass("hidden")},fo=function(){$("#upload-overlay").removeClass("hidden"),$("#blurred-layer").addClass("overlay-blur"),$(".blurred-shadow").removeClass("hidden")},go=function(e,t,o){if(!io&&"input-event-fail"===e&&o.hasOwnProperty("error")){io=!0,so=0,lo=!1;var r=o.error,i=no;if(r===gt){Y.log("qgMultiUpload show payment overlay file too large"),o.hasOwnProperty("size")&&(so=o.size),i+="/size";var n=ro.getInputList(),a=1===n.getNumberOfAllInputs();return so>0&&a&&(i+="?filesize="+so),void L(i,"filesize",so)}return"uploader-error-too-many-inputs"===r?(Y.log("qgMultiUpload show payment overlay too many files"),i+="/inputs",lo=!0,void L(i,"tooManyFiles")):r===ht?(Y.log("qgMultiUpload show payment overlay youtube forbidden"),void co()):"api-error-try-reload"===r?void qgAlertHelper.show(qgAlertHelper.alerts.ERROR_TRY_RELOAD):void("api-error-overuse"===r&&(Y.log("qgMultiUpload overuse"),i+="/overuse",L(i,"overuse")))}},ho=function(e,t){function o(){$("body").removeClass("has-modal"),$(".signup-modal-backdrop").removeClass("show").addClass("hidden"),io=!1,Y.log("upload overlay close")}ro=e,ro.registerInputEventCallback(go),$(document).on("click","#register-submit",function(e){e.preventDefault(),G("#signup-form","signup")&&($(this).find("i").addClass("fa-spinner fa-spin"),$(this).prop("disabled",!0),Q(function(){V()},"#signup-form"))}),$(document).on("click","#login-submit",function(e){e.preventDefault(),G("#login-form","login")&&($(this).find("i").addClass("fa-spinner fa-spin"),$(this).prop("disabled",!0),Q(function(){W()},"#login-form"))}),$(document).on("click",".login-link",function(e){e.preventDefault(),B("login")}),$(document).on("click",".signup-link",function(e){e.preventDefault(),B("register")}),$(document).on("click",".modal-close",o),$(document).on("click",".signup-modal-backdrop",function(e){$(e.target).hasClass("signup-modal-backdrop")&&o()}),$(document).on("click","#social-login-twitter, #social-login-facebook, #social-login-google",function(e){e.preventDefault();var o=t.socialBaseUrl+"/social-login?provider="+$(this).data("provider")+"&modal_reason="+window.modal_reason+"&_is_modal=true";"undefined"!=typeof window.fileSize&&(o+="&file_size="+window.fileSize),window.location=o}),$(document).on("click","#register-success-submit",function(e){e.preventDefault(),$(this).find("i").addClass("fa-spinner fa-spin"),$(this).prop("disabled",!0),Q(function(){$("#register-success-submit").prop("disabled",!1).find("i").removeClass("fa-spinner fa-spin"),X()},"#confirmation-resend-form")}),$(".premium-user-btn").click(function(){var e=t.registerUrl;so>0?e+="/size?filesize="+so:!0===lo&&(e+="/inputs"),window.location.href=e}),no=t.registerUrl,ao=t.domain+"/apiv2",uo=$("#upload-overlay .payment-required"),po=$("#upload-overlay .youtube-forbidden")},vo={init:ho},mo={fileSize:function(e){return"number"!=typeof e?"":e>=1073741824?(e/1073741824).toFixed(2)+" GB":e>=1048576?(e/1048576).toFixed(2)+" MB":e>=1024?(e/1024).toFixed(2)+" KB":1!==e?e.toFixed(2)+" bytes":e.toFixed(2)+" byte"},bitrate:function(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" Gbit/s":e>=1e6?(e/1e6).toFixed(2)+" Mbit/s":e>=1e3?(e/1e3).toFixed(2)+" kbit/s":e.toFixed(2)+" bit/s"},time:function(e){qe(e);var t=new Date(1e3*e),o=Math.floor(e/86400),r=o?o+"d ":"",i=("0"+t.getUTCHours()).slice(-2),n=("0"+t.getUTCMinutes()).slice(-2),a=("0"+t.getUTCSeconds()).slice(-2);return e<3600?n+":"+a:r+i+":"+n+":"+a},percentage:function(e){return qe(e),he(e>=-.1),he(e<=1.1),(100*e).toFixed(0)}},bo=!1,_o=function(){bo||(bo=!0,$(document).on("click","[data-hide-alert]",function(){var e="."+$(this).attr("data-hide-alert");return $(this).closest(e).removeClass("show"),!1}))},yo={show:function(e){bo||_o(),$(e).addClass("show")},hide:function(e){bo||_o(),$(e).removeClass("show")},remove:function(e){bo||_o(),$(e).remove()},isVisible:function(e){bo||_o(),$(e).is(":visible")},alerts:{INPUT_MISSING:".alert-input-missing",PASSWORD_MISSING:".alert-password-missing",PASSWORD_WRONG:".alert-password-wrong",INVALID_API_KEY:".alert-invalid-api-key",ERROR_TRY_RELOAD:".alert-try-reload"}},wo=function(e){try{e=Translator.trans(e)}catch(t){Y.log("translator exception",t.message)}return e},Io=function(e,t){try{e=wo(e),$.notify({message:e},{type:t,placement:{from:"top",align:"right"}})}catch(o){}},Co={info:function(e){Io(e,"info")},warning:function(e){Io(e,"warning")},success:function(e){Io(e,"success")},error:function(e){Io(e,"danger")}},xo=function(e,t){Oe(e,"invalid template name"),void 0===t&&(t={}),Ie(t);var o=tmpl(e),r=o(t);return r instanceof $?r:$("<div></div>").html(r).children()};Z.prototype._getFileList=function(){var e=$(this.fileListSelector);return he(1===e.length,"cant find file input element"),e},Z.prototype._createNewRow=function(e){qe(e);var t=this._getFileList(),o=xo("template-base-row");o.addClass("local-id-"+e),o.addClass("uploader-input-element"),t.append(o)},Z.prototype._updateRow=function(e,t,o){qe(e),Oe(t);var r=this._getRow(e),i=xo(t,o);r.html(i)},Z.prototype._hideRow=function(e){qe(e),this._getRow(e).addClass("hidden")},Z.prototype._getRow=function(e){qe(e);var t=this._getFileList(),o=t.find(".local-id-"+e);return he(1===o.length,"cant find row: "+e),o},Z.prototype._updateInputStatusCssClass=function(e,t){qe(e),Qe(t);var o=this._getFileList(),r=o.find(".local-id-"+e);he(1===r.length,"cant find row: "+e);var i=r.attr("class").split(/\s+/);return $.each(i,function(e,t){0===t.indexOf("input-status-")&&r.removeClass(t)}),t===lt?r.addClass("input-status-queued"):"input-status-submitting-to-api"===t?r.addClass("input-status-submitting"):"input-status-loading"===t?r.addClass("input-status-loading"):"input-status-done"===t?r.addClass("input-status-done"):"input-status-failed"===t?r.addClass("input-status-failed"):"input-status-password-missing"===t?r.addClass("input-status-password-missing"):"input-status-deleting"===t?r.addClass("input-status-deleting"):"input-status-deleted"===t?r.addClass("input-status-deleted"):r.addClass("input-status-unknown"),r};var qo=function(e){$(".input-id-"+e+" i").removeClass("fa-unlock-alt"),$(".input-id-"+e+" i").addClass("fa-spin fa-spinner")},So=function(e){$(".input-id-"+e+" i").removeClass("fa-spin fa-spinner"),$(".input-id-"+e+" i").addClass("fa-unlock-alt")};Z.prototype.enablePwInput=function(e){var t=this._getRow(e),o=t.find(".password-inputs"),r=t.find('input[type="password"]'),i=t.find(".pwbutton");if(r.keydown(function(e){13==e.keyCode&&i.trigger("click",p)}),o.hasClass("hidden")){o.removeClass("hidden");var n=this._uploader.getInput(e),a=n.getInputId();i.addClass("input-id-"+a);var s=this,l=this._uploader.getJob().getId(),d=function(){qo(a),i.prop("disabled",!0)},u=function(){So(a),i.prop("disabled",!1)},p=function(){var t=r.val();""!==t&&(d(),s._apiHelper.setPassword(l,a,t).done(function(t){return u(),Ae(t)&&Ae(t.metadata)?St(t.metadata)?(r.val(""),"oc"===s._type&&yo.show(yo.alerts.PASSWORD_WRONG),void("sat"===s._type&&Co.warning("Wrong password, please enter the correct one!"))):(o.addClass("hidden"),s._uploader.getInput(e).setStatus("input-status-done"),void s._uploader.dispatchInputEvent("input-event-done",e)):(Y.log("qgMultiUpload set password - fail - metadata broken",JSON.stringify(t)),o.addClass("hidden"),s._uploader.getInput(e).setStatus("input-status-done"),void s._uploader.dispatchInputEvent("input-event-done",e))}).fail(function(e){r.val(""),u(),Y.log("qgMultiUpload set password fail",e+"input id: "+a),"oc"===s._type&&("api-error-try-reload"===e?yo.show(yo.alerts.ERROR_TRY_RELOAD):yo.show(yo.alerts.PASSWORD_WRONG)),"sat"===s._type&&Co.error("Failed to set password. Please try again!")}))};i.on("click",p),$(".pwd").submit(function(){return!1})}},Z.prototype.enableDeleteButton=function(e){var t=this;this._getRow(e).find(".deletebutton").click(function(){t._uploader.deleteInput(e)})},Z.prototype.enableFileUploadCancelButton=function(e){var t=this;this._getRow(e).find(".cancelbutton").click(function(){t._uploader.cancelFileUpload(e)})},Z.prototype._showPasswordEntryField=function(e){if("input-status-password-missing"===this._uploader.getInput(e).getStatus()){var t=this._uploader.getInput(e).getType(),o=this._uploader.getInput(e).getName(),r=this._uploader.getInput(e).getSize(),i=null;"type-dropbox"===t?i="template-dropbox-added":"type-external-url"===t?i="template-external-url-added":"type-upload"===t?i="template-file-uploaded":"type-gdrive"===t?i="template-gdrive-added":"type-input-id"===t?i="template-external-url-added":he(!1);var n={name:o,size:mo.fileSize(r)};this._updateRow(e,i,n),this._updateInputStatusCssClass(e,"input-status-password-missing"),this.enableDeleteButton(e),this.enablePwInput(e)}},Z.prototype._showUploadDone=function(e){var t=this._uploader.getInput(e).getType(),o=this._uploader.getInput(e).getName(),r=this._uploader.getInput(e).getSize(),i=null;"type-dropbox"===t?i="template-dropbox-added":"type-external-url"===t?i="template-external-url-added":"type-upload"===t?i="template-file-uploaded":"type-gdrive"===t?i="template-gdrive-added":"type-input-id"===t?i="template-external-url-added":he(!1);var n={name:o,size:mo.fileSize(r)};this._updateRow(e,i,n),this._updateInputStatusCssClass(e,"input-status-done"),this.enableDeleteButton(e),this._uploader.getInputList().getNumberOfAllInputs()>1&&this.showPasswordOnlyForSingleInput&&this._hideAllPasswordMissing()},Z.prototype._showStartLoading=function(e){var t=this._uploader.getInput(e).getType(),o=this._uploader.getInput(e).getName(),r=this._uploader.getInput(e).getSize(),i=null;"type-dropbox"===t?i="template-dropbox-adding":"type-external-url"===t?i="template-external-url-adding":"type-upload"===t?i="template-file-uploading":"type-gdrive"===t?i="template-gdrive-adding":"type-input-id"===t?i="template-external-url-adding":he(!1);var n={name:o,size:mo.fileSize(r)};this._updateRow(e,i,n),this._updateInputStatusCssClass(e,"input-status-loading"),"type-upload"===t&&this.enableFileUploadCancelButton(e)},Z.prototype._showUploadFail=function(e){if(!1===this.showFailedInput)return void this._hideRow(e);var t=this._uploader.getInput(e).getType(),o=this._uploader.getInput(e).getName(),r=this._uploader.getInput(e).getSize(),i=null;"type-dropbox"===t?i="template-dropbox-fail":"type-external-url"===t?i="template-external-url-fail":"type-upload"===t?i="template-file-upload-fail":"type-gdrive"===t?i="template-gdrive-fail":"type-input-id"===t?i="template-external-url-fail":he(!1);var n={name:o,size:mo.fileSize(r)};"object"==typeof data&&data.hasOwnProperty("error")&&"uploader-error-too-many-inputs"===data.error&&(i="template-file-upload-fail-too-many-files"),this._updateRow(e,i,n),this._updateInputStatusCssClass(e,"input-status-failed")},Z.prototype._showUploadDeleted=function(e){this._hideRow(e),this._updateInputStatusCssClass(e,"input-status-deleted");var t=this._uploader.getInputList();if(0===t.getNumberOfDoneInputs()&&1===t.getNumberOfPasswordMissing()&&this.showPasswordOnlyForSingleInput){var o=this;$(t._inputs).each(function(e,t){"input-status-password-missing"===t._status&&o._showPasswordEntryField(t._localId)})}},Z.prototype._showUploadCanceled=function(e){var t=this._uploader.getInput(e).getName(),o={name:t};this._updateRow(e,"template-file-upload-canceled",o),this._updateInputStatusCssClass(e,"input-status-deleted")},Z.prototype._hideAllPasswordMissing=function(){$(".password-inputs").addClass("hidden"),qgAlertHelper.hide(qgAlertHelper.alerts.PASSWORD_MISSING),qgAlertHelper.hide(qgAlertHelper.alerts.PASSWORD_WRONG)},Z.prototype.onInputQueued=function(e){this._createNewRow(e),this._updateRow(e,"template-waiting"),this._updateInputStatusCssClass(e,lt)},Z.prototype.onStartLoading=function(e){this._showStartLoading(e)},Z.prototype.onUploadDone=function(e){this._showUploadDone(e)},Z.prototype.onPasswordMissing=function(e){var t=this._uploader.getInputList();if(t.getNumberOfDoneInputs()+t.getNumberOfPasswordMissing()>1&&this.showPasswordOnlyForSingleInput)return void this._showUploadDone(e);this._showPasswordEntryField(e)},Z.prototype.onUploadFail=function(e,t){this._showUploadFail(e)},Z.prototype.onUploadDeleted=function(e){this._showUploadDeleted(e)},Z.prototype.onUploadCanceled=function(e){this._showUploadCanceled(e)},Z.prototype.getAveragedBitrate=function(e,t){"undefined"==typeof this.oldBitrates[e]&&(this.oldBitrates[e]=[]),this.oldBitrates[e].push(t);var o=this.oldBitrates[e].slice(-20);this.oldBitrates[e]=o;for(var r=0,i=0;i<o.length;i++)r+=o[i];return r/o.length},Z.prototype.onUploadProgress=function(e,t){var o="",r=0;if("number"==typeof t)o=t+"%",r=t;else{if("object"!=typeof t)throw new Error("unknown data passed in progress event");var i=t.bytesLoaded/t.bytesTotal*100;r=Math.floor(i);var n=i.toFixed(1)+"%",a=this.getAveragedBitrate(e,t.bitrate),s=t.bytesTotal-t.bytesLoaded,l=8*s/a;o=n+" - "+mo.time(l)}var d=this._getRow(e);d.find(".progress").attr("aria-valuenow",r),d.find(".progress-bar").css("width",r+"%"),d.find(".progress-text").text(o)},Z.prototype.callback=function(e,t,o){try{if(Ye(e),"input-event-queued"===e)return void this.onInputQueued(t);if("input-event-start-submitting"===e)return;if(e===rt)return void this.onStartLoading(t);if("input-event-upload-canceled"===e)return void this.onUploadCanceled(t);if("input-event-deleted"===e)return void this.onUploadDeleted(t);if("input-event-password-missing"===e)return void this.onPasswordMissing(t);if("input-event-done"===e)return void this.onUploadDone(t);if("input-event-fail"===e)return void this.onUploadFail(t,o);if("input-event-upload-progress"===e)return void this.onUploadProgress(t,o)}catch(r){Y.log("uploadui exception",r)}};var $o=function(e,t){return Ie(t),new Z("oc",e,t)},Oo=null,Fo=null,ko=null,Uo=function(e){var t=$("#category").val(),o=e.inputForm,r=e.target,i=$(o).validate({ignoreTitle:!0,onkeyup:!1,onsubmit:!1,rules:qgValidate.qgRules,messages:qgValidate.qgMessages});return qgValidate.init(!0),qgValidate.initAdditionalRules(t,r,o),i},jo=function(){"string"==typeof window.qgInputFromGetInputId&&Oo.addInputId(window.qgInputFromGetInputId),"string"==typeof window.qgInputFromGetExternalUrl&&Oo.addExternalUrl(window.qgInputFromGetExternalUrl),"string"==typeof window.qgInputFromGetGDriveToken&&"string"==typeof window.qgInputFromGetGDriveFilename&&"string"==typeof window.qgInputFromGetGDriveFileId&&"string"==typeof window.qgInputFromGetGDriveMimeType&&Oo.addGdrive(window.qgInputFromGetGDriveFilename,window.qgInputFromGetGDriveToken,window.qgInputFromGetGDriveFileId,window.qgInputFromGetGDriveMimeType)},Do=function(e){$("#listItemExternalUrl").remove(),$("#multifileUploadBox").show(),$(".multifile-submit-button").removeClass("hidden"),$("input[type='submit']").addClass("hidden");var t={form:function(){return!0},showErrors:function(e){}};try{t=Uo(e)}catch(n){Y.log("qgMultiUpload setup validation fail","exception message: "+n.message)}var o={preventNavigateAway:!0,domain:e.feApiBaseUrl,registerUrl:e.feRegisterUrl,resultBase:e.resultBase,formValidator:t,target:e.target,category:e.category,isFreeUser:e.isFreeUser,supportTargetSwitch:e.supportTargetSwitch,ignoreMissingPasswords:e.ignoreMissingPasswords,socialBaseUrl:e.socialBaseUrl},r={};r.baseApiData={},r.baseUrlApi=e.feApiBaseUrl,r.enablePasswords=e.enablePasswords,r.showPasswordOnlyForSingleInput=e.showPasswordOnlyForSingleInput,r.enableUploadFallback=!0,r.fileUploadInputId="#fileUploadInput",r.fileListSelector="#fileUploadList",r.gdriveClientId=gdrive_clientId,r.gdriveDeveloperKey=gdrive_developerKey,r.maxFileSize=e.maxFileSize,r.maxNumberOfInputs=e.maxInputs,r.jobData={target:e.target,category:e.category,fail_on_input_error:!1,fail_on_conversion_error:!1,process:!1},"string"==typeof e.presetStringMethod&&e.presetStringMethod.length>0&&(r.jobData.preset_string_method=e.presetStringMethod);var i=$(".csrf_token");i.length>0&&(r.baseApiData={csrf_token:i.val()}),r.blockYouTubeUrls=!1,"audio"!==e.category&&"video"!==e.category||(r.blockYouTubeUrls=!0),ko=Pt(r),Oo=new U(ko,r),window.qgUploader=Oo,Fo=$o(Oo,r),to.init(Oo,o),vo.init(Oo,o),jo(),oo(Oo)},Ao={init:Do},Po=null,Jo=function(e){Po=e,$(".jsenabled").show(),$("#presetPage").length&&Eo.init(),!$("#presetPage").length&&$("#globalPresetDropdown").length&&Ro.init(),Ho.init(),No.checkIfAudioVbrPage(),No.setCategory(),No.beforeUnload();var t=$("#multifileUploadBox").length>0,o=fe.isModernBrowser(),r=fe.supportsTarget(),i=fe.supportsCors(),n=fe.supportsJquerySerialize();t&&o&&r?Ao.init(e):i&&r&&n?(window.qgCapabilities=fe,qgOldUploader.init(e)):(window.qgCapabilities=fe,qgVeryOldUploader.init(e))},Ho={init:function(){$(".optional_settings").length&&$("#save-settings-list-entry").show(),$("#userPresetDropdown").length&&($("#saved-settings-container").show(),$("#userPresetDropdown").prop("disabled",!1),$("#save-settings-name").prop("disabled",!1),$("#userPresetDropdown").change(function(){if(!user_preset_options_json.hasOwnProperty(this.value))return void Ho.clearAllValues(!0);Ho.clearAllValues(!1),Ho.setSavedOptionsValues(user_preset_options_json[this.value])}),Ho.resetSelectedUserPresetOnOptionsChange())},clearAllValues:function(e){$(".optional_settings :input").each(function(){if($(this).is("select")){if(!e&&"user_preset"===this.name)return;$(this)[0].selectedIndex=0}else $(this).is(":checkbox")?$(this).prop("checked",!1):$(this).is(":radio")?$('[name="'+this.name+'"]:first').prop("checked",!0):"category"!==this.name&&$(this).val("")}),$("#bitrate").show()},setSavedOptionsValues:function(e){$.each(e,function(e,t){"channel"===e&&"video"===Po.category&&(e="audio_channel");var o="[name='"+e+"']";$(o).is("select")?($(o).find('option[value="'+t+'"]').prop("selected",!0),"audio_vbr"===e&&""!==t&&$("#bitrate").hide(),"audio_bitrate"===e&&""!==t&&$("#bitrate").show(),"resize_handling"===e&&(t.indexOf("keep_aspect_ratio_")>=0&&($("#resizeHandling").val("keep_aspect_ratio_fill"),$("#resizeHandlingFill").val(t)),"keep_aspect_ratio_fill"===$("#resizeHandling option:selected").val()?$("#resizeHandlingFill").removeClass("hidden"):$("#resizeHandlingFill").addClass("hidden"))):$(o).is(":checkbox")||"checkbox"===$(o).attr("type")?("1"===t||"alpha_channel"===e&&"auto_create"===t)&&$(o).prop("checked",t):$(o).is(":radio")?$(o+"[value='"+t+"']").prop("checked",!0):$(o).val(t),"target"===e&&$("#presetPage").length&&Eo.updatePresetOptions(t)})},resetSelectedUserPresetOnOptionsChange:function(){$(".optional_settings :input").change(function(){"user_preset"!==this.name&&0!==$("#userPresetDropdown")[0].selectedIndex&&($("#userPresetDropdown")[0].selectedIndex=0)})}},Ro={init:function(){$("#presetPage").length||$("#globalPresetDropdown").length&&($("#globalPresetDropdown").find("option").not(":first").remove(),Ro.showJsPresets(),$("#globalPresetDropdown").change(function(){""!==this.value?Ro.disableOptionsForPresetConversion():Ro.enableBlockedPresetOptions()}))},disableOptionsForPresetConversion:function(){$("#width").val(""),$("#width").prop("disabled",!0),$("#width").addClass("isDisabled"),$("#height").val(""),$("#height").prop("disabled",!0),$("#height").addClass("isDisabled"),$("#rate").val(""),$("#rate").prop("disabled",!0),$("#rate").addClass("isDisabled"),$("#video_codec").append('<option value="">from preset</option>'),$("#video_codec").val(""),$("#video_codec").prop("disabled",!0),$("#video_codec").addClass("isDisabled"),$("#audio_codec").append('<option value="">from preset</option>'),$("#audio_codec").val(""),$("#audio_codec").prop("disabled",!0),$("#audio_codec").addClass("isDisabled")},enableBlockedPresetOptions:function(){$("#width").prop("disabled",!1),$("#width").removeClass("isDisabled"),$("#height").prop("disabled",!1),$("#height").removeClass("isDisabled"),$("#rate").prop("disabled",!1),$("#rate").removeClass("isDisabled"),$("#video_codec").prop("disabled",!1),$("#video_codec").removeClass("isDisabled"),$("#video_codec option[value='']").remove(),$("#audio_codec").prop("disabled",!1),$("#audio_codec").removeClass("isDisabled"),$("#audio_codec option[value='']").remove()},showJsPresets:function(){$.each(all_presets_json,function(e,t){$("#globalPresetDropdown").append('<option value="'+e+'">'+t.name+"</option>")})}},Eo={init:function(){if($("#presetPage").length){Eo.showPresetJsOptions(),Eo.setCurrentPresetCategory();var e=$("#category").val();Eo.showOptionsForCategory(e),$("#category").change(function(){Eo.showOptionsForCategory(this.value)}),$("#target").change(function(){$("#globalPresetDropdown").empty(),Eo.updatePresetOptions(this.value)});var t=K("selected_preset");null!==t&&$.each(presets_data,function(e,o){var r=!1;if($.each(o,function(e,o){if(t===e)return $("#target").val(o.target).trigger("change"),$("#globalPresetDropdown").val(e),r=!0,!1}),!0===r)return!1})}},showPresetJsOptions:function(){$(".presetNonJsOptions").remove(),$(".presetJsOptions").show()},setCurrentPresetCategory:function(){$.each(presets_data[$("#target").val()],function(e,t){return $("#category").val(t.category).trigger("change"),!1})},updatePresetOptions:function(e){var t=!1;$.each(presets_data[e],function(e,o){$("#globalPresetDropdown").append($("<option></option>").attr("value",e).text(o.name)),t||($("#category").val(o.category).trigger("change"),t=!0)})},showOptionsForCategory:function(e){"audio"===e?($(".video_options").hide(),$(".video_options_input").prop("disabled",!0),$(".video_options_input").addClass("isDisabled"),$(".audio_options").show(),$(".audio_options_input").prop("disabled",!1),$(".audio_options_input").removeClass("isDisabled")):"video"===e?($(".video_options").show(),$(".video_options_input").prop("disabled",!1),$(".video_options_input").removeClass("isDisabled"),$(".audio_options").hide(),$(".audio_options_input").prop("disabled",!0),$(".audio_options_input").addClass("isDisabled")):($(".target_options").hide(),$(".audio_options_input").prop("disabled",!0),$(".audio_options_input").addClass("isDisabled"),$(".video_options_input").prop("disabled",!0),$(".video_options_input").addClass("isDisabled"))}},No={checkIfAudioVbrPage:function(){$("#audio_vbr").length&&No.handleAudioVbrPage()},setCategory:function(){try{"string"==typeof $("#category").val()?Po.category=$("#category").val():(Y.log("qgHandle setCategory - noCategory"),Po.category="NO_CATEGORY")}catch(e){Y.log("qgHandle checkCategory - noCategory"),Po.category="NO_CATEGORY"}},handleAudioVbrPage:function(){$("#audio_vbr").change(function(){"0"!==this.value?To.hideCbrOptions():To.showCbrOptions()})},beforeUnload:function(){$(window).bind("beforeunload",function(){if(window.unsaved)return Y.log("qgHandle qgJob Upload browser closed by user"),"You have unsaved changes on this page. Do you want to leave this page and discard your changes or stay on this page?"})}},To={showCbrOptions:function(){$("#bitrate").show()},hideCbrOptions:function(){$("#bitrate").val(0),$("#bitrate").hide()}};window.qgHandle={init:Jo}}();var qgValidate=function(){var e={},t={},o=function(e){t.capCors=e,l()},r=function(e,t,o){switch(e){case"image":var r=65e3,i=65e3,n=qgValidate.qgMessages.image_width.range,a=qgValidate.qgMessages.image_height.range;"ico"===t&&(r=256,i=256,n=qgValidate.qgMessages.image_ico_width.range,a=qgValidate.qgMessages.image_ico_height.range),$("#width").rules("add",{digits:!0,range:[1,r],messages:{digits:qgValidate.qgMessages.digits,range:n}}),$("#height").rules("add",{digits:!0,range:[1,i],messages:{digits:qgValidate.qgMessages.digits,range:a}});break;case"video":$("#width").rules("add",{digits:!0,range:[1,1e4],messages:{digits:qgValidate.qgMessages.digits,range:qgValidate.qgMessages.video_width.range}}),$("#height").rules("add",{digits:!0,range:[1,1e4],messages:{digits:qgValidate.qgMessages.digits,range:qgValidate.qgMessages.video_height.range}})}},i=function(){return!!$("#external_url").val()},n=function(){return!!$("#file").val()},a=function(){return!!document.getElementById("gdrive_input")},s=function(){return!!document.getElementById("hash_string")&&$("#hash_string").val().length>0},l=function(){$.validator.addMethod("allowExactlyOneUploadSource",function(e,o){if(!1===t.capCors)return!0;var r=i()+n()+a()+s();return r>1?this.optional(o)||!1:0!==r},function(e,t){return 0===i()+n()+a()+s()?qgValidate.qgMessages.noInputDefinedByUser:qgValidate.qgMessages.moreThanOneInputDefinedByUser}),$.validator.addMethod("custom_url",function(e,t){return this.optional(t)||e.length>=4&&e.length<=4e3},"Please provide a valid URL."),jQuery.validator.addMethod("filename_length",function(e,t){return this.optional(t)||$("#file").val().length<=130},"Filename Too Long"),jQuery.validator.addMethod("filesize",function(e,t,o){return this.optional(t)||t.files[0].size<=o}),jQuery.validator.addMethod("filesizeZero",function(e,t){return this.optional(t)||t.files[0].size>0},"The file does not contain any data and therefore can't be converted"),jQuery.validator.addMethod("timestamp",function(e,t){return this.optional(t)||/^[0-9]{2}:[0-9]{2}:[0-9]{2}$/.test(e)},e.timestamp),jQuery.validator.addMethod("video_bitrate",function(e,t){return 0==$("#video_target_size").length||(this.optional(t)||!($("#video_target_size").val().length>0&&$("#video_quality").val().length>0))},e.bitrateFilesize)};return{init:o,initAdditionalRules:r,qgRules:{file:{allowExactlyOneUploadSource:!0,filename_length:!0},external_url:{allowExactlyOneUploadSource:!0,normalizer:function(e){return $.trim(e)},custom_url:!0,maxlength:2500},hash_string:{allowExactlyOneUploadSource:!0,maxlength:4096},dpi:{digits:!0,range:[10,1200]},border:{number:!0,range:[0,20]},video_bitrate:{video_bitrate:!0,number:!0,range:[5,1e5]},file_size:{video_bitrate:!0,number:!0,range:[.005,2e3]},framerate:{number:!0,range:[1,120]},start:{timestamp:!0},end:{timestamp:!0},crop_top:{number:!0,range:[0,1e5]},crop_bottom:{number:!0,range:[0,1e5]},crop_left:{number:!0,range:[0,1e5]},crop_right:{number:!0,range:[0,1e5]},base_font_size:{number:!0,range:[6,22]},black_white_threshold:{number:!0,range:[1,255]},black_white_threshold_svg:{number:!0,range:[0,100]},speckles_threshold:{number:!0,range:[8,1e7]}},qgMessages:e}}(),qgOldUploader=function(){"use strict";var e=function(e,t){try{if(void 0===t)t={};else if("string"==typeof t)t={info:t};else if("object"!=typeof t)try{t={info:JSON.stringify(t)}}catch(o){}a.length>0&&(t.job_id=JSON.stringify(a)),window.qgLogger.log(e,t)}catch(o){}},t=null,o=null,r=10,i=!1,n=null,a=[],s=null,l=null,d=null,u=null,p=null,c=null,f=null,g=0,h=null,v=function(){return{form:function(){return!0},showErrors:function(e){}}},m=v(),b=v(),_=function(e){window.location=u+e},y={initMain:function(t){var o=t;$("#listItemExternalUrl").show(),g=o.maxFileSize,n=o.inputForm,s=o.fileForm,l=o.fileInput,d=o.requestDomain,u=o.resultBase,p=o.overuseUrl,c=o.filetoobigUrl,f=$("#category").val(),h=o.target;try{m=$(n).validate({ignoreTitle:!0,onkeyup:!1,onsubmit:!1,rules:qgValidate.qgRules,messages:qgValidate.qgMessages}),b=$(s).validate({ignoreTitle:!0,onkeyup:!1,onsubmit:!1,rules:qgValidate.qgRules,messages:qgValidate.qgMessages})}catch(r){e("qgHandle init - error setting up form validators")}jQuery().fileupload||e("qgHandle init - jquery fileuploader not available"),y.initFileUploader(s),y.isFileUploaderInitialized(s)||e("qgHandle init - jquery fileuploader not initialized"),y.initSubmitButton()},initSubmitButton:function(){qgValidate.init(qgCapabilities.supportsCors()),y.setupValidationEvents(m,b),qgValidate.initAdditionalRules(f,h,n),$(n).submit(function(e){e.preventDefault();var t=b.form(),o=m.form();t&&o&&I()&&(i||(i=!0,C.createJob()))})},initFileUploader:function(t){try{qgOldUploaderHelper.initFileUploader(t,q,e)}catch(r){var o="no error message in exception";r.hasOwnProperty("message")&&(o=r.message),e("qgHandle qgUpload uploadSingleFile fail on create",{error_message:o})}w.showFileUpload()},isFileUploaderInitialized:function(e){try{$("#forms-input").fileupload("active")}catch(t){return!1}return!0},setupValidationEvents:function(e,t){$("#external_url").change(function(){t.form(),e.form()}),$("#file").change(function(){t.form(),e.form()}),$("#hash_string").change(function(){t.form(),e.form()})}},w={showFileUpload:function(){$(".main-input-form").show(),$("#cloud_convert").show()},showCreateJob:function(){$("#qg-submit").hide(),w.openForms(),$("#cloud_convert").find("a").css("pointer-events","none"),$("#cloud_convert").find("#drive_picker").css("pointer-events","none"),$("#oc-ajax-loader-bar-uploading").hide(),$("#oc-ajax-loader-bar").show()},resetPage:function(){window.unsaved=!1,i=!1,$("#qg-submit").show(),w.openForms(),$("#oc-ajax-loader-bar").hide(),$("#oc-ajax-loader-bar-uploading").hide(),$("#oc-upload-progress").hide(),$(".progress-bar-v2").css("width","0%"),$("#cloud_convert").find("a").css("pointer-events","all"),$("#cloud_convert").find("#drive_picker").css("pointer-events","all")},showProgress:function(){this.closeForms(),$("#oc-ajax-loader-bar").hide(),$("#ajax-loader-bar").hide(),$("#oc-upload-progress").show()},openForms:function(){$(n+" input").not(".isDisabled").prop("disabled",!1),$(s+" input").not(".isDisabled").prop("disabled",!1),$(n+" select").not(".isDisabled").prop("disabled",!1)},destroyFileupload:function(e){$(e).fileupload("disable"),$(e).fileupload("destroy")},showUploading:function(){$("#oc-ajax-loader-bar").hide(),$("#oc-ajax-loader-bar-uploading").show()},closeForms:function(){$(n+" input").prop("disabled",!0),$(s+" input").prop("disabled",!0),$(n+" select").prop("disabled",!0)}},I=function(){if(!qgCapabilities.supportsFileApi())return!0;try{var t=$(l)[0].files[0];return"undefined"==typeof $(l)[0].files[0]||(t.size>g?(e("qgHandle checkConstraints - maxFileSize exceeded",{file_size:t.size,max_file_size:g}),window.unsaved=!1,window.location.assign(c+t.size),!1):0!==t.size||!qgCapabilities.supportsBlob()||(b.showErrors({file:"The file does not contain any data and therefore can't be converted"}),e("qgHandle checkConstraints - filesizeZero"),!1))}catch(r){var o="no info";try{o=r.message}catch(i){}return e("qgHandle checkConstraints - exception",{exception_message:o}),!0}},C={createJob:function(){w.showCreateJob(),qgJob.createJob(d,n).done(function(r,i){if(null==r)return e("qgHandle qgJob createJob fail - empty server response"),alert("Something went wrong, please try again later!"),void w.resetPage();if(r.hasOwnProperty("error"))return void C.handleJobCreateErrorCode(r);if(r.hasOwnProperty("text")&&"Captcha Error"===r.text)return alert("Captcha not solved!"),void w.resetPage();if("string"!=typeof r.job_id)return e("qgHandle qgJob createJob fail - broken server response",{response:JSON.stringify(r)}),alert("Something went wrong, please try again later!"),void w.resetPage();if(a.push(r.job_id),e("qgHandle qgJob createJob success"),!0===r.redirect)return e("qgHandle qgUpload UploadSingleFile success with remote input"),void _(r.job_id);if(window.unsaved=!0,t=r.token,o=r.upload_url,$(s).attr("action",o),$("#token").val(t),$("#redirect_to").val(u+r.job_id),$("#redirect_register").val(p),qgCapabilities.supportsBlob())try{w.showProgress(),qgOldUploaderHelper.uploadStart(o,t)}catch(l){w.openForms();try{w.destroyFileupload()}catch(d){}var n="no error message in exception";l.hasOwnProperty("message")&&(n=l.message),x(n)}else x("no blob")}).fail(function(e,t){if(e&&e.hasOwnProperty("error"))return void C.handleJobCreateErrorCode(e);C.retryJob(e,t)})},handleJobCreateErrorCode:function(t){var o="Something went wrong, please try again later!";if(!t.hasOwnProperty("error")||!t.error.hasOwnProperty("code"))return e("qgHandle qgJob createJob fail - broken error response",{response:JSON.stringify(t)}),alert(o),void w.resetPage();var r=t.error.code;return 1===r?(e("qgHandle qgJob createJob fail - overuse"),void(window.location=p)):2===r?(e("qgHandle qgJob createJob fail - invalid option",{response:JSON.stringify(t)}),alert(o),void w.resetPage()):5===r?(e("qgHandle qgJob createJob fail - forbidden Input ID",{response:JSON.stringify(t)}),alert(t.error.text),void w.resetPage()):(e("qgHandle qgJob createJob fail - unhandled error code",{response:JSON.stringify(t)}),alert(o),void w.resetPage())},retryJob:function(t,o){var i="",n="";try{i=JSON.stringify(t)}catch(a){i=JSON.stringify(a)}try{n=JSON.stringify(o)}catch(a){n=JSON.stringify(a)}r>0?(e("qgHandle qgJob createJob fail - retry",{server_response:i,form_info_data:n}),r-=1,window.setTimeout(C.createJob,1e3)):(e("qgHandle qgJob createJob critical fail - retries exhausted",{server_response:i,form_info_data:n}),alert(qgValidate.qgMessages.networkErrorMessage),w.resetPage())}},x=function(t){t||(t="no error message given"),w.openForms(),w.showUploading(),e("qgHandle qgUpload UploadSingleFile success with fallback upload",{error_message:t}),window.unsaved=!1,$(s).unbind("submit").submit(),w.closeForms()},q={createUUID:function(e){try{return e+Math.floor(65536*(1+Math.random())).toString(6)}catch(t){return Math.floor(65536*(1+Math.random())).toString(6)}},updateProgress:function(e){$("#uploadfilesize").html(e.size),$("#uploadrate").html(e.speed),$("#uploadtimeleft").html(e.time),$(".progress-bar-v2").css("width",e.percentage+"%")},uploadDone:function(t,o){window.unsaved=!1,e("qgHandle qgUpload UploadSingleFile success");var r="noInfo";try{r=JSON.stringify(o.slice(-30))}catch(a){}try{if(!0===t.jqXHR.responseJSON.completed)_(t.jqXHR.responseJSON.id.job);else{var i="no json response";try{i=JSON.stringify(t.jqXHR.responseJSON)}catch(s){}e("qgHandle qgUpload UploadSingleFile critical fail - response from server broken",{upload_info:r,json_response:i}),alert(qgValidate.qgMessages.networkErrorMessage),w.resetPage()}}catch(a){try{var n="no info";try{n=a.message}catch(s){}e("qgHandle qgUpload UploadSingleFile critical fail - response from server broken",{upload_info:r,exception_message:n}),alert(qgValidate.qgMessages.networkErrorMessage),w.resetPage()}catch(a){e("qgHandle qgUpload UploadSingleFile critical fail - response from server broken"),alert(qgValidate.qgMessages.networkErrorMessage),w.resetPage()}}},uploadError:function(t,o,r,i){window.unsaved=!1,"undefined"==typeof r.jqXHR.responseJSON?e("qgHandle qgUpload UploadSingleFile error with non-json response"):"undefined"!=typeof r.jqXHR.responseJSON.error_code?(e("qgHandle qgUpload UploadSingleFile error with code",{error_code:r.jqXHR.responseJSON.error_code}),3===r.jqXHR.responseJSON.error_code&&(window.unsaved=!1,window.location.assign(c+r.jqXHR.responseJSON.filesize_mb)),2===r.jqXHR.responseJSON.error_code&&(window.unsaved=!1,e("qgHandle qgUpload UploadSingleFile success with dl trust"),_(a[0])),5===r.jqXHR.responseJSON.error_code&&(e("qgHandle qgUpload UploadSingleFile critical fail - Invalid File"),alert(qgValidate.qgMessages.networkErrorMessage),w.resetPage())):(e("qgHandle qgUpload UploadSingleFile error json response without error_code"),alert(qgValidate.qgMessages.networkErrorMessage),w.resetPage()),e(t,i)}};return{init:function(e){y.initMain(e)},getJobId:function(){return a}}}(),qgOldUploaderHelper=function(){var e={uploadUrl:null,uploadToken:null,uploadUUID:null,uploadForm:null},t=[],o={},r=function(r,s,l){o.handleUpload=s,o.log=l,e.uploadForm=r,$(r).fileupload({url:e.uploadUrl,dataType:"json",maxChunkSize:n.getDynamicChunkSize,singleFileUploads:!0,autoUpload:!1,replaceFileInput:!1,maxRetries:50,dropZone:null,retryTimeout:500,retries:0,beforeSend:function(t,o){t.setRequestHeader("x-oc-token",e.uploadToken),t.setRequestHeader("X-Oc-Upload-Uuid",e.uploadUUID)}}).bind("fileuploadadd",function(t,r){qgOldUploaderHelper.uploadStart=function(t,i){e.uploadUrl=t,e.uploadToken=i,e.uploadUUID=o.handleUpload.createUUID(e.uploadToken),r.submit()}}).bind("fileuploaddone",function(e,r){o.handleUpload.uploadDone(r,t)}).bind("fileuploadfail",function(t,a){if(n.resetChunkSpeed(),a&&"object"==typeof a.jqXHR&&"undefined"!=typeof a.jqXHR.responseJSON)if("Problem uploading file"===a.jqXHR.responseJSON.error)i(a,t);else{try{if("undefined"!=typeof $(r).find("input:file")[0].files[0])var s=$(r).find("input:file")[0].files[0];else var s={name:null,size:null,type:null}}catch(l){var s={name:null,size:null,type:null}}o.handleUpload.uploadError("qgHandle qgUpload singleFileUpload - general error info",t,a,{token:e.uploadToken,server:e.uploadUrl,uuid:e.uploadUUID,file_info:JSON.stringify({name:s.name,size:s.size,type:s.type}),response:JSON.stringify(a.jqXHR.responseJSON)})}else i(a,t)}).bind("fileuploadprogress",function(e,t){o.handleUpload.updateProgress(a.renderData(t))}).bind("fileuploadchunkdone",function(e,t){var o=$(this).data("blueimp-fileupload")||$(this).data("fileupload");n.increaseChunkSpeed(),o.options.retries>10&&(o.options.retries=10)}).bind("fileuploadchunkalways",function(o,r){var i={range:r.contentRange,loaded:r.loaded,uploadedBytes:r.uploadedBytes,textStatus:r.textStatus,url:r.url,uuid:e.uploadUUID};t.push(i)})},i=function(r,i){var n=$(e.uploadForm).data("blueimp-fileupload")||$(e.uploadForm).data("fileupload"),s=function(){r.submit()};"abort"!==r.errorThrown&&r.uploadedBytes<r.files[0].size&&n.options.retries<n.options.maxRetries?(o.handleUpload.uploadError("qgHandle qgUpload singleFileUpload - chunk fail: retry",i,r,{token:e.uploadToken,uuid:e.uploadUUID,server:e.uploadUrl,bitrate:a.formatBitrate(r._bitrateTimer.bitrate),totalLoaded:a.formatFileSize(r._bitrateTimer.loaded),currentRetry:n.options.retries}),n.options.retries+=1,window.setTimeout(s,n.options.retries*n.options.retryTimeout)):(t=t.slice(-30),o.handleUpload.uploadError("qgHandle qgUpload singleFileUpload critical fail - retries exhausted",i,r,{token:e.uploadToken,uuid:e.uploadUUID,server:e.uploadUrl,chunkinfo:JSON.stringify(t)}),alert(qgValidate.qgMessages.networkErrorMessage))},n={baseChunkSize:1e6,minChunkSize:1e5,maxChunkSize:1e8,speedModifier:3,maxSpeedModifier:5,increaseChunkSpeed:function(){n.limitSpeed(++n.speedModifier)},resetChunkSpeed:function(){n.speedModifier=1},getDynamicChunkSize:function(e){var t=e.progress();if(0===t.loaded)return n.baseChunkSize;if(1===n.speedModifier)return n.minChunkSize;var o=parseInt(t.bitrate)*n.speedModifier;return n.limitChunk(o)},limitChunk:function(e){return Math.max(n.minChunkSize,Math.min(e,n.maxChunkSize))},limitSpeed:function(e){n.speedModifier=Math.max(1,Math.min(e,n.maxSpeedModifier))}},a={renderData:function(e){return{speed:this.formatBitrate(e.bitrate),size:this.formatFileSize(e.loaded)+" / "+this.formatFileSize(e.total),time:this.formatTime(8*(e.total-e.loaded)/e.bitrate),percentage:this.formatPercentage(e.loaded/e.total)}},formatBitrate:function(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" Gbit/s":e>=1e6?(e/1e6).toFixed(2)+" Mbit/s":e>=1e3?(e/1e3).toFixed(2)+" kbit/s":e.toFixed(2)+" bit/s"},formatFileSize:function(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB"},formatTime:function(e){var t=new Date(1e3*e),o=Math.floor(e/86400);return(o=o?o+"d ":"")+("0"+t.getUTCHours()).slice(-2)+":"+("0"+t.getUTCMinutes()).slice(-2)+":"+("0"+t.getUTCSeconds()).slice(-2)},formatPercentage:function(e){return(100*e).toFixed(0)}};return{initFileUploader:r}}(),qgVeryOldUploader=function(){return{init:function(e){var t=e;$(t.inputForm).submit(function(e){e.preventDefault(),$(t.inputForm).unbind("submit").submit()})}}}(),qgJob=function(){"use strict";var e=function(e,t){try{window.qgLogger.log(e,t)}catch(o){}},t=function(t){var o=$.Deferred(),r=t.replace(/(\/dl.*)/,"/dl/alive"),r=r.replace("http:","https:");return $.ajax({type:"GET",url:r,timeout:15e3}).done(function(e,t,r){o.resolve()}).fail(function(r,i,n){var a=t.match(/(www[^.]*)/)[0],s={upload_server:a,ajax_text_status:i,ajax_error_thrown:n,http_status:r.status};e("qgHandle qgJob createJob upload server not available",s),o.reject()}),o};return{createJob:function(o,r){var i=$.Deferred(),n=$(r).serialize(),a=0,s=function(){$.ajax({type:"POST",url:o,data:n,cache:!1,xhrFields:{withCredentials:!0}}).done(function(o){if("string"==typeof o)try{o=JSON.parse(o)}catch(r){return e("qgHandle qgJob createJob error while json-parsing server response",{response:o}),void i.resolve(o,n)}return o.hasOwnProperty("job_id")&&o.hasOwnProperty("upload_url")?"string"==typeof o.upload_url&&o.upload_url?void t(o.server).done(function(){i.resolve(o,n)}).fail(function(){if(a<5){a++;var e=1e3*Math.pow(a/2,2);setTimeout(function(){s()},e)}else i.reject("reached max dl server check",n)}):(e("qgHandle qgJob createJob problem with upload_url",{response:JSON.stringify(o)}),void i.resolve(o,n)):void i.resolve(o,n)}).fail(function(e,t){i.reject(t,n)})};return s(),i}}}(),qgFileoptions=function(){return{getOptions:function(e,t,o){var r=$.Deferred(),i={source_format:t};return void 0!==o&&(i.mime_type=o),$.ajax({type:"POST",url:e,data:i,cache:!1,xhrFields:{withCredentials:!0}}).done(function(e){try{r.resolve(JSON.parse(e))}catch(t){r.resolve(e)}}).fail(function(e,t){r.reject(t,e)}),r}}}(),qgHandleCloud=function(){return{init:function(e,t,o,r){switch(e){case"qgGdrive":qgGdrive.init(t,o,r)}}}}(),qgGdrive=function(){var e=function(e,o){try{if(void 0===o)o={};else if("string"==typeof o)o={info:o};else if("object"!=typeof o)try{o={info:JSON.stringify(o)}}catch(r){}try{t.jobId.length>0&&(o.job_id=JSON.stringify(t.jobId))}catch(r){}window.qgLogger.log(e,o)}catch(r){}},t={usesGdrive:!1,requestDomainJob:"",requestDomainOptions:"",inputForm:"#gdriveform",jobId:[],driveData:null,driveScope:"https://www.googleapis.com/auth/drive.readonly https://www.googleapis.com/auth/drive.install",driveClient:"",driveKey:"",driveDiscovery:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],driveFile:{},fallBack:!1},o={},r=[{info:{name:"Document converter",title:"Free online document converter",category:"document"},target:{"convert-to-doc":{method:"convert-to-doc",converter_name:"Convert to DOC",title:"Convert PDF and other documents to Word",raw_method:"doc",subdomain:"document",url:"/convert-to-doc",category:"document"},"convert-to-pdf":{method:"convert-to-pdf",converter_name:"Convert to PDF",title:"Convert documents and images to PDF",raw_method:"pdf",subdomain:"document",url:"/convert-to-pdf",category:"document"},"convert-to-docx":{method:"convert-to-docx",converter_name:"Convert to DOCX",title:"Convert your documents to DOCX",raw_method:"docx",subdomain:"document",url:"/convert-to-docx",category:"document"},"convert-to-txt":{method:"convert-to-txt",converter_name:"Convert to TXT",title:"Convert your document to text",raw_method:"txt",subdomain:"document",url:"/convert-to-txt",category:"document"},"convert-to-flash":{method:"convert-to-flash",converter_name:"Convert to Flash",title:"Convert files to a Flash slideshow",raw_method:"swf",subdomain:"document",url:"/convert-to-flash",category:"document"},"convert-to-html":{method:"convert-to-html",converter_name:"Convert to HTML",title:"Convert a document to HTML",raw_method:"html",subdomain:"document",url:"/convert-to-html",category:"document"},"convert-to-odt":{method:"convert-to-odt",converter_name:"Convert to ODT",title:"Convert to Open-Office ODT format",raw_method:"odt",subdomain:"document",url:"/convert-to-odt",category:"document"},"convert-to-ppt":{method:"convert-to-ppt",converter_name:"Convert to PPT",title:"Powerpoint converter",raw_method:"ppt",subdomain:"document",url:"/convert-to-ppt",category:"document"},"convert-to-pptx":{method:"convert-to-pptx",converter_name:"Convert to PPTX",title:"Convert files to the Powerpoint PPTX format",raw_method:"pptx",subdomain:"document",url:"/convert-to-pptx",category:"document"},"convert-to-rtf":{method:"convert-to-rtf",converter_name:"Convert to RTF",title:"Online RTF converter",raw_method:"rtf",subdomain:"document",url:"/convert-to-rtf",category:"document"}}},{info:{name:"Audio converter",title:"Convert your audio to another format",category:"audio"},target:{"convert-to-mp3":{method:"convert-to-mp3",converter_name:"Convert to MP3",title:"Convert audio to MP3",raw_method:"mp3",subdomain:"audio",url:"/convert-to-mp3",category:"audio"},"convert-to-ogg":{method:"convert-to-ogg",converter_name:"Convert to OGG",title:"Convert audio to the OGG format",raw_method:"ogg",subdomain:"audio",url:"/convert-to-ogg",category:"audio"},"convert-to-wav":{method:"convert-to-wav",converter_name:"Convert to WAV",title:"Convert audio to WAV",raw_method:"wav",subdomain:"audio",url:"/convert-to-wav",category:"audio"},"convert-to-wma":{method:"convert-to-wma",converter_name:"Convert to WMA",title:"Convert audio and video to WMA",raw_method:"wma",subdomain:"audio",url:"/convert-to-wma",category:"audio"},"convert-to-aac":{method:"convert-to-aac",converter_name:"Convert to AAC",title:"Music converter to AAC",raw_method:"aac",subdomain:"audio",url:"/convert-to-aac",category:"audio"},"convert-to-aiff":{method:"convert-to-aiff",converter_name:"Convert to AIFF",title:"Convert audio to AIFF",raw_method:"aiff",subdomain:"audio",url:"/convert-to-aiff",category:"audio"},"convert-to-flac":{method:"convert-to-flac",converter_name:"Convert to FLAC",title:"Convert audio to FLAC",raw_method:"flac",subdomain:"audio",url:"/convert-to-flac",category:"audio"},"convert-to-m4a":{method:"convert-to-m4a",converter_name:"Convert to M4A",title:"Online audio converter to M4A",raw_method:"m4a",subdomain:"audio",url:"/convert-to-m4a",category:"audio"},"convert-to-mmf":{method:"convert-to-mmf",converter_name:"Convert to MMF",title:"Convert audio to the MMF ringtone format",raw_method:"mmf",subdomain:"audio",url:"/convert-to-mmf",category:"audio"},"convert-to-opus":{method:"convert-to-opus",converter_name:"Convert to OPUS",title:"Convert files to the OPUS format",raw_method:"opus",subdomain:"audio",url:"/convert-to-opus",category:"audio"}}},{info:{name:"Audio converter",title:"Convert your audio to another format",category:"audio"},target:{"convert-to-mp3":{method:"convert-to-mp3",converter_name:"Convert to MP3",title:"Convert audio to MP3",raw_method:"mp3",subdomain:"audio",url:"/convert-to-mp3",category:"audio"},"convert-to-ogg":{method:"convert-to-ogg",converter_name:"Convert to OGG",title:"Convert audio to the OGG format",raw_method:"ogg",subdomain:"audio",url:"/convert-to-ogg",category:"audio"},"convert-to-wav":{method:"convert-to-wav",converter_name:"Convert to WAV",title:"Convert audio to WAV",raw_method:"wav",subdomain:"audio",url:"/convert-to-wav",category:"audio"},"convert-to-wma":{method:"convert-to-wma",converter_name:"Convert to WMA",title:"Convert audio and video to WMA",raw_method:"wma",subdomain:"audio",url:"/convert-to-wma",category:"audio"},"convert-to-aac":{method:"convert-to-aac",converter_name:"Convert to AAC",title:"Music converter to AAC",raw_method:"aac",subdomain:"audio",url:"/convert-to-aac",category:"audio"},"convert-to-aiff":{method:"convert-to-aiff",converter_name:"Convert to AIFF",title:"Convert audio to AIFF",raw_method:"aiff",subdomain:"audio",url:"/convert-to-aiff",category:"audio"},"convert-to-flac":{method:"convert-to-flac",converter_name:"Convert to FLAC",title:"Convert audio to FLAC",raw_method:"flac",subdomain:"audio",url:"/convert-to-flac",category:"audio"},"convert-to-m4a":{method:"convert-to-m4a",converter_name:"Convert to M4A",title:"Online audio converter to M4A",raw_method:"m4a",subdomain:"audio",url:"/convert-to-m4a",category:"audio"},"convert-to-mmf":{method:"convert-to-mmf",converter_name:"Convert to MMF",title:"Convert audio to the MMF ringtone format",raw_method:"mmf",subdomain:"audio",url:"/convert-to-mmf",category:"audio"},"convert-to-opus":{method:"convert-to-opus",converter_name:"Convert to OPUS",title:"Convert files to the OPUS format",raw_method:"opus",subdomain:"audio",url:"/convert-to-opus",category:"audio"}}},{info:{name:"Archive converter",title:"Convert archives",category:"archive"},target:{"convert-to-zip":{method:"convert-to-zip",converter_name:"Convert to ZIP",title:"Convert your files to the ZIP format",raw_method:"zip",subdomain:"archive",url:"/convert-to-zip",category:"archive"},"convert-to-7z":{method:"convert-to-7z",converter_name:"Convert to 7Z",title:"7z file converter",raw_method:"7z",subdomain:"archive",url:"/convert-to-7z",category:"archive"},"convert-to-bz2":{method:"convert-to-bz2",converter_name:"Convert to TAR.BZ2",title:"Create TAR.BZ2 archives online",raw_method:"bz2",subdomain:"archive",url:"/convert-to-bz2",category:"archive"},"convert-to-gz":{method:"convert-to-gz",converter_name:"Convert to TAR.GZ",title:"Online TAR.GZ compressor",raw_method:"gz",subdomain:"archive",url:"/convert-to-gz",category:"archive"}}},{info:{name:"Image converter",title:"Online image converter",category:"image"},target:{"convert-to-jpg":{method:"convert-to-jpg",converter_name:"Convert to JPG",title:"Online image converter to JPEG",raw_method:"jpg",subdomain:"image",url:"/convert-to-jpg",category:"image"},"convert-to-png":{method:"convert-to-png",converter_name:"Convert to PNG",title:"Convert image to PNG",raw_method:"png",subdomain:"image",url:"/convert-to-png",category:"image"},"convert-to-gif":{method:"convert-to-gif",converter_name:"Convert to GIF",title:"Convert files to GIF",raw_method:"gif",subdomain:"image",url:"/convert-to-gif",category:"image"},"convert-to-bmp":{method:"convert-to-bmp",converter_name:"Convert to BMP",title:"Convert an image to the BMP format",raw_method:"bmp",subdomain:"image",url:"/convert-to-bmp",category:"image"},"convert-to-eps":{method:"convert-to-eps",converter_name:"Convert to EPS",title:"Convert an image to the EPS format",raw_method:"eps",subdomain:"image",url:"/convert-to-eps",category:"image"},"convert-to-exr":{method:"convert-to-exr",converter_name:"Convert to HDR/EXR",title:"Convert an image to the High dynamic-range (HDR) .EXR format",raw_method:"exr",subdomain:"image",url:"/convert-to-exr",category:"image"},"convert-to-ico":{method:"convert-to-ico",converter_name:"Convert to ICO",title:"Convert your image to the ICO format",raw_method:"ico",subdomain:"image",url:"/convert-to-ico",category:"image"},"convert-to-svg":{method:"convert-to-svg",converter_name:"Convert to SVG",title:"Convert image to the SVG format",raw_method:"svg",subdomain:"image",url:"/convert-to-svg",category:"image"},"convert-to-tga":{method:"convert-to-tga",converter_name:"Convert to TGA",title:"Convert image to TGA format",raw_method:"tga",subdomain:"image",url:"/convert-to-tga",category:"image"},"convert-to-tiff":{method:"convert-to-tiff",converter_name:"Convert to TIFF",title:"Convert image to TIFF format",raw_method:"tiff",subdomain:"image",url:"/convert-to-tiff",category:"image"},"convert-to-wbmp":{method:"convert-to-wbmp",converter_name:"Convert to WBMP",title:"Convert image to WBMP (mobile format)",raw_method:"wbmp",subdomain:"image",url:"/convert-to-wbmp",category:"image"},"convert-to-webp":{method:"convert-to-webp",converter_name:"Convert to WebP",title:"Convert an image to WebP",raw_method:"webp",subdomain:"image",url:"/convert-to-webp",category:"image"}}},{info:{name:"Video converter",title:"Video file converter",category:"video"},target:{"convert-to-3gp":{method:"convert-to-3gp",converter_name:"Convert to 3GP",title:"Convert video to 3GP",raw_method:"3gp",subdomain:"video",url:"/convert-to-3gp",category:"video"},"convert-to-avi":{method:"convert-to-avi",converter_name:"Convert to AVI",title:"Online AVI video converter",raw_method:"avi",subdomain:"video",url:"/convert-to-avi",category:"video"},"convert-to-mkv":{method:"convert-to-mkv",converter_name:"Convert to MKV",title:"Convert video to the Matroska (MKV) format",raw_method:"mkv",subdomain:"video",url:"/convert-to-mkv",category:"video"},"convert-to-mp4":{method:"convert-to-mp4",converter_name:"Convert to MP4",title:"Convert video to MP4",raw_method:"mp4",subdomain:"video",url:"/convert-to-mp4",category:"video"},"convert-to-3g2":{method:"convert-to-3g2",converter_name:"Convert to 3G2",title:"3G2 video converter",raw_method:"3g2",subdomain:"video",url:"/convert-to-3g2",category:"video"},"convert-to-flv":{method:"convert-to-flv",converter_name:"Convert to FLV",title:"Online video converter to FLV",raw_method:"flv",subdomain:"video",url:"/convert-to-flv",category:"video"},"convert-to-mov":{method:"convert-to-mov",converter_name:"Convert to MOV",title:"Convert video to Quicktime MOV",raw_method:"mov",subdomain:"video",url:"/convert-to-mov",category:"video"},"convert-to-mpeg-1":{method:"convert-to-mpeg-1",converter_name:"Convert to MPEG-1",title:"Convert video to MPEG-1",raw_method:"mpeg1",subdomain:"video",url:"/convert-to-mpeg-1",category:"video"},"convert-to-mpeg-2":{method:"convert-to-mpeg-2",converter_name:"Convert to MPEG-2",title:"Convert video to MPEG-2",raw_method:"mpeg2",subdomain:"video",url:"/convert-to-mpeg-2",category:"video"},"convert-to-ogv":{method:"convert-to-ogv",converter_name:"Convert to OGV",title:"Convert video to the OGV format",raw_method:"ogg",subdomain:"video",url:"/convert-to-ogv",category:"video"},"convert-to-webm":{method:"convert-to-webm",converter_name:"Convert to WEBM",title:"Video converter to convert to the WebM format (VP8)",raw_method:"webm",subdomain:"video",url:"/convert-to-webm",category:"video"},"convert-to-wmv":{method:"convert-to-wmv",converter_name:"Convert to WMV",title:"Online WMV video converter",raw_method:"wmv",subdomain:"video",url:"/convert-to-wmv",category:"video"},"convert-video-for-android":{method:"convert-video-for-android",converter_name:"Convert video for Android",title:"Convert video for Android devices",raw_method:"android",subdomain:"video",url:"/convert-video-for-android",category:"video"},"convert-video-for-blackberry":{method:"convert-video-for-blackberry",converter_name:"Convert video for Blackberry",title:"Blackberry video converter",raw_method:"Blackberry",subdomain:"video",url:"/convert-video-for-blackberry",category:"video"},"convert-video-for-ipad":{method:"convert-video-for-ipad",converter_name:"Convert video for iPad",title:"iPad video converter",raw_method:"ipad",subdomain:"video",url:"/convert-video-for-ipad",category:"video"},"convert-video-for-iphone":{method:"convert-video-for-iphone",converter_name:"Convert video for iPhone",title:"Convert your video for your iPhone",raw_method:"iphone",subdomain:"video",url:"/convert-video-for-iphone",category:"video"},"convert-video-for-ipod":{method:"convert-video-for-ipod",converter_name:"Convert video for iPod",title:"Online video to iPod converter",raw_method:"ipod",subdomain:"video",url:"/convert-video-for-ipod",category:"video"},"convert-video-for-nintendo-3ds":{method:"convert-video-for-nintendo-3ds",converter_name:"Convert video for Nintendo 3DS",title:"Convert videos for the Nintendo 3DS",raw_method:"3ds",subdomain:"video",url:"/convert-video-for-nintendo-3ds",category:"video"},"convert-video-for-nintendo-ds":{method:"convert-video-for-nintendo-ds",converter_name:"Convert video for Nintendo DS",title:"Convert your video to the Nintendo DS DPG format",raw_method:"dpg",subdomain:"video",url:"/convert-video-for-nintendo-ds",category:"video"},"convert-video-for-ps3":{method:"convert-video-for-ps3",converter_name:"Convert video for PS3",title:"Convert video for Playstation3 (PS3)",raw_method:"ps3",subdomain:"video",url:"/convert-video-for-ps3",category:"video"},"convert-video-for-psp":{method:"convert-video-for-psp",converter_name:"Convert video for PSP",title:"Convert video for your PSP",raw_method:"psp",subdomain:"video",url:"/convert-video-for-psp",category:"video"},"convert-video-for-wii":{method:"convert-video-for-wii",converter_name:"Convert video for Wii",title:"Convert video for Nintendo Wii",raw_method:"wii",subdomain:"video",url:"/convert-video-for-wii",category:"video"},"convert-video-for-xbox":{method:"convert-video-for-xbox",converter_name:"Convert video for XBOX 360",title:"Convert video for the XBOX 360",raw_method:"xbox",subdomain:"video",url:"/convert-video-for-xbox",category:"video"}}},{info:{name:"Webservice converter",title:"Optimize a file for a webservice",category:"webservice"},target:{"convert-video-for-dailymotion":{method:"convert-video-for-dailymotion",converter_name:"Convert for Dailymotion",title:"Dailymotion video converter",raw_method:"mp4",subdomain:"webservice",url:"/convert-video-for-dailymotion",category:"video",name:"dailymotion"},"convert-for-facebook":{method:"convert-for-facebook",converter_name:"Convert for Facebook",title:"Convert your video for Facebook",raw_method:"mp4",subdomain:"webservice",url:"/convert-for-facebook",category:"video",name:"facebook"},"convert-for-instagram":{method:"convert-for-instagram",converter_name:"Convert for Instagram",title:"Convert video for Instagram",raw_method:"mp4",subdomain:"webservice",url:"/convert-for-instagram",category:"video",name:"instagram"},"convert-for-telegram":{method:"convert-for-telegram",converter_name:"Convert for Telegram",title:"Convert a file for Telegram",raw_method:"mp4",subdomain:"webservice",url:"/convert-for-telegram",category:"video",name:"telegram"},"convert-video-for-twitch":{method:"convert-video-for-twitch",converter_name:"Convert for Twitch",title:"Convert your file for Twitch",raw_method:"mp4",subdomain:"webservice",url:"/convert-video-for-twitch",category:"video",name:"twitch"},"convert-for-twitter":{method:"convert-for-twitter",converter_name:"Convert for Twitter",title:"Convert your file for Twitter",raw_method:"mp4",subdomain:"webservice",url:"/convert-for-twitter",category:"video",name:"twitter"},"convert-video-for-viber":{method:"convert-video-for-viber",converter_name:"Convert for Viber",title:"Viber video converter",raw_method:"mp4",subdomain:"webservice",url:"/convert-video-for-viber",category:"video",name:"viber"},"convert-video-for-vimeo":{method:"convert-video-for-vimeo",converter_name:"Convert for Vimeo",title:"Video converter for vimeo",raw_method:"mp4",subdomain:"webservice",url:"/convert-video-for-vimeo",category:"video",name:"vimeo"},"convert-for-whatsapp":{method:"convert-for-whatsapp",converter_name:"Convert for WhatsApp",title:"Convert a file for WhatsApp",raw_method:"mp4",subdomain:"webservice",url:"/convert-for-whatsapp",category:"video",name:"whatsapp"},"convert-video-for-youtube":{method:"convert-video-for-youtube",converter_name:"Convert for Youtube",title:"Video converter for Youtube",raw_method:"mp4",subdomain:"webservice",url:"/convert-video-for-youtube",category:"video",name:"youtube"}}}],i=function(e,o,r){t.usesGdrive=!0,t.driveClient=o,t.driveKey=r,""!==e&&(d.showProgress(),a.parseDriveData(e),n.loadAuth())},n={loadAuth:function(){gapiPromise.then(function(){try{window.gapi.load("client:auth",qgGdrive.drive.initClient)}catch(t){e("qgGdrive gapi load not available",t.message)}})},initClient:function(){try{window.gapi.client.init({discoveryDocs:t.driveDiscovery,clientId:t.driveClient,scope:t.driveScope}),qgGdrive.drive.onAuthApiLoad()}catch(o){e("qgGdrive failed to init client",o.message)}},onAuthApiLoad:function(){try{window.gapi.auth.authorize({client_id:t.driveClient,scope:t.driveScope,prompt:"none",login_hint:t.driveData.userId},qgGdrive.drive.handleAuthResult)}catch(o){e("qgGdrive failed to authorize",o.message)}},onAuthApiLoadScope:function(){if(!window.gapi)return void e("qgGdrive gapi not available","onAuthApiLoadScope");window.gapi.auth.authorize({client_id:t.driveClient,scope:t.driveScope,prompt:"consent",login_hint:t.driveData.userId},qgGdrive.drive.handleAuthResult)},handleAuthResult:function(e){e&&!e.error?(t.driveFile.token=e.access_token,"object"==typeof t.driveData.ids?n.getFileMetadata(t.driveData.ids[0]):n.getFileMetadata(t.driveData.exportIds[0])):s.renderConsent()},onDriveCallback:function(){},getFileMetadata:function(o){if(!window.gapi)return void e("qgGdrive gapi not available","getFileMetadata");d.showProgress(),gapi.client.drive.files.get({fileId:o}).execute(function(e){404===e.code?!1===t.fallBack&&(t.fallBack=!0,n.onAuthApiLoadScope()):n.setFile(e.name,o,e.mimeType,t.driveFile.token)})},setFile:function(e,o,r,i){t.driveFile.token=i,t.driveFile.fileName=e,t.driveFile.fileId=o,t.driveFile.mimeType=r,a.processDriveFile()},checkUsesGdrive:function(){return t.usesGdrive}},a={parseDriveData:function(e){try{t.driveData=JSON.parse(e)}catch(o){}},processDriveFile:function(){var o="",r=t.driveFile.mimeType;o=t.driveFile.fileName.indexOf(".")>-1?t.driveFile.fileName.substr(t.driveFile.fileName.lastIndexOf(".")+1):r,t.driveFile.url="?g_fileid="+t.driveFile.fileId+"&g_filename="+t.driveFile.fileName+"&g_token="+t.driveFile.token+"&g_mimetype="+t.driveFile.mimeType+"&g_sizebytes="+t.driveFile.sizeBytes,e("qgGdrive processDrive options extension",{extension:o}),qgFileoptions.getOptions(qgGdrive.qgEndpoint.requestDomainOptions,o,r).done(function(e){s.renderOptions(e)}).fail(function(e,t){if(400!==t.status)return alert(qgValidate.qgMessages.networkErrorMessage),void d.resetPage();s.renderGenericOptions()})}},s={renderConsent:function(){d.hideProgress(),$("#gdriveConsent").click(function(){n.onAuthApiLoadScope()}),$("#gdriveConsent-box").show(),$("#drive_picker").hide()},renderOptions:function(e){$("#gdrive_input").val(JSON.stringify(t.driveFile)),$("#g-filename").html(t.driveFile.fileName),$("#g-selected-file").show(),$("#gdrive-options").empty(),d.hideProgress(),$.each(e,function(e,o){if(0!==o.target.length){var r="<h2>"+o.info.name+'</h2><div id="gcat-'+e+'"></div>';$("#gdrive-options").append(r),$.each(o.target,function(o,r){var i=$("#convert-tpl").clone();i.find(".submit_button_big").val(r.converter_name),i.find(".submit_button_big").attr("name",o),i.find(".submit_button_big").attr("data-category",r.category),i.find(".submit_button_big").attr("data-target",r.raw_method),i.find("a").attr("href",r.url+t.driveFile.url),i.appendTo("#gcat-"+e),i.show()})}}),$(".submit_button_big").click(function(){$("#target").val($(this).attr("data-target")),$("#category").val($(this).attr("data-category")),s.createJob()})},renderGenericOptions:function(){var e=window.location.host.split("."),t=window.location.protocol+"//",o=e[1]+"."+e[2];$.each(r,function(e,r){$.each(r.target,function(e,r){r.url=t+r.subdomain+"."+o+r.url})}),s.renderOptions(r)},createJob:function(){d.showUpload(),qgJob.createJob(qgGdrive.qgEndpoint.requestDomainJob,t.inputForm).done(function(o,r){if("string"==typeof o.job_id)t.jobId.push(o.job_id),e("qgGdrive qgJob createJob success"),!0===o.redirect&&(e("qgGdrive qgUpload UploadSingleFile success with remote input"),s.showResult(o.job_id));else try{1==o.error.code?(e("qgGdrive qgJob createJob fail - overuse"),window.location=qgGdrive.qgEndpoint.overuseUrl):3==o.error.code?(e("qgGdrive qgJob createJob fail - "+o.error.text),alert(o.error.text),d.resetPage()):l(o,r)}catch(i){l(o,r)}}).fail(function(t,o){try{1==t.error.code?(e("qgGdrive qgJob createJob fail - overuse"),window.location=qgGdrive.qgEndpoint.overuseUrl):3==t.error.code?(e("qgGdrive qgJob createJob fail - "+t.error.text),alert(t.error.text),d.resetPage()):l(t,o)}catch(r){l(t,o)}})},showResult:function(e){window.location=qgGdrive.qgEndpoint.requestDomainResult+e}},l=function(o,r){try{var i=JSON.stringify(o),n=JSON.stringify(r)}catch(a){var i=JSON.stringify(a),n="empty"}t.maxRetriesJob>0?(e("qgGdrive qgJob createJob fail - retry",{server_response:i,form_info_data:n}),t.maxRetriesJob-=1,window.setTimeout(s.createJob,t.retryTimeoutJob)):(e("qgGdrive qgJob createJob critical fail - retries exhausted",{server_response:i,form_info_data:n}),alert(qgValidate.qgMessages.networkErrorMessage),d.resetPage())},d={showProgress:function(){$("#gdriveConsent-box").hide(),$("#drive_picker").hide(),$("#oc-ajax-loader-bar").show()},hideProgress:function(){$("#gdriveConsent-box").hide(),$("#drive_picker").show(),$("#oc-ajax-loader-bar").hide()},showUpload:function(){$("#drive_picker").css("pointer-events","none"),$("#drive_picker").css("pointer-events","none"),$("#gdrive-options").hide(),$("#oc-ajax-loader-bar-uploading").show()},hideUpload:function(){$("#drive_picker").css("pointer-events","all"),$("#drive_picker").css("pointer-events","all"),$("#gdrive-options").show(),$("#oc-ajax-loader-bar-uploading").hide()},resetPage:function(){d.hideProgress(),d.hideUpload()}};return{init:i,qgEndpoint:o,drive:n}}();