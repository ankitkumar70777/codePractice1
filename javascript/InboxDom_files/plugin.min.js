$(document).ready(function(){xbackground.initialize()});var xbackground=new function(){var data={};this.initialize=function(){this.data=rcmail.env.xbackgroundData;this.busy=false;this.error=false;if($(".readtext h2.sysname").length){return}if(this.isSettingsPage()){$("body").append($("<form>").attr("id","xbackground-upload-form").attr("enctype","multipart/form-data").attr("action",rcmail.url("xbackground_upload_image")).attr("method","post").append($("<input>").attr("type","file").attr("name","file").attr("accept","image/*").attr("id","xbackground-upload-input").attr("style","display:none").on("change",function(){xbackground.uploadImage()})));$("#xbackground-upload-form").ajaxForm({dataType:"json",beforeSubmit:function(){return $("#xbackground-upload-input").val()?true:false},success:function(data){xbackground.busy=false;xbackground.data.image="custom";xbackground.data.customImageUrl=data.url;xbackground.resetUploadInput();xbackground.update()},error:function(data){xbackground.busy=false;xbackground.error=data.statusText;xbackground.resetUploadInput();xbackground.update()}})}this.update()};this.changeImage=function(image){this.data.image=image;this.update();if(!this.isSettingsPage()){rcmail.save_pref({name:"xbackground_image",value:this.data.image})}};this.changePlacement=function(){this.data.placement=$("#xbackground_placement").val();this.update()};this.changeTextColor=function(){this.data.textColor=$("#xbackground_text_color").val();this.update()};this.changeImageOpacity=function(){this.data.imageOpacity=$("#xbackground_image_opacity").val();this.update()};this.changeContentOpacity=function(){this.data.contentOpacity=$("#xbackground_content_opacity").val();this.update()};this.changeBlur=function(){this.data.blur=$("#xbackground_blur").val();this.update()};this.changeGray=function(){this.data.gray=$("#xbackground_gray").val();this.update()};this.isSettingsPage=function(){return $("#xbackground-image-value").length};this.uploadImage=function(){if($("#xbackground-upload-input").val()){this.busy=true;this.error=false;this.update();$("#xbackground-upload-form").submit()}};this.deleteImage=function(){this.busy=true;this.error=false;$.ajax({dataType:"json",url:rcmail.url("xbackground_delete_image"),method:"GET",success:function(data){xbackground.busy=false;xbackground.data.image="none";xbackground.data.customImageUrl=false;xbackground.update()},error:function(data){xbackground.busy=false;xbackground.error=data.statusText;xbackground.resetUploadInput();xbackground.update()}})};this.resetUploadInput=function(){$("#xbackground-upload-input").val("")};this.update=function(){this.updateBodyClasses($("body"));if($("body").hasClass("iframe")||$("html").hasClass("iframe")){this.updateBodyClasses($("body",window.parent.document))}if(this.isSettingsPage()){if(this.data.customImageUrl){$("#xbackground-delete-button").show();$("#xbackground-image-box-custom").attr("style","background-image: url("+this.data.customImageUrl+"); display:inline-block;");$("#xbackground_placement").parents("tr").show()}else{$("#xbackground-image-box-custom").hide();$("#xbackground-delete-button").hide();$("#xbackground_placement").parents("tr").hide()}if(this.data.image=="none"){$("body").css("background","")}else{$("body").css("background","transparent")}if(this.busy){$("#xbackground-upload-buttons input").css("visibility","hidden");$("#xbackground-upload-buttons").css("background-image","url(plugins/xbackground/assets/images/loader.gif)")}else{$("#xbackground-upload-buttons input").css("visibility","visible");$("#xbackground-upload-buttons").css("background-image","none")}if(this.error){$("#xbackground-upload-error").text(this.error).show()}else{$("#xbackground-upload-error").text("").hide()}$("#xbackground-image-value").val(this.data.image)}};this.updateBodyClasses=function(body){var background=body.find("#xbackground-body");if(this.data.image=="none"){body.alterClass("xbg xbg*");background.css("background-image","none")}else{var textColor=this.data.textColor;if(this.data.image=="custom"){textColor=="auto"&&(textColor=this.data.customDark?"light":"dark");background.css("background-image","url("+this.data.customImageUrl+")");body.alterClass("xbg-placement*","xbg-placement-"+this.data.placement)}else{textColor=="auto"&&(textColor=this.data.images[this.data.image].textColor);background.css("background-image","none");body.alterClass("xbg-placement*","xbg-placement-"+this.data.images[this.data.image].placement)}if(textColor=="light"&&this.data.imageOpacity<40){textColor="dark"}body.alterClass("xbg-image*","xbg xbg-image-"+this.data.image);body.alterClass("xbg-image-opacity*","xbg-image-opacity-"+this.data.imageOpacity);body.alterClass("xbg-blur*","xbg-blur-"+this.data.blur);body.alterClass("xbg-gray*","xbg-gray-"+this.data.gray);body.alterClass("xbg-content-opacity*","xbg-content-opacity-"+this.data.contentOpacity);body.alterClass("xbg-text-color*","xbg-text-color-"+textColor)}}};