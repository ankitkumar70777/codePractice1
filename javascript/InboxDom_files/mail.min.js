rcmail.register_command("add-events-to-calendar",function(){xcalendarMail.showSelectCalendarDialog()});rcmail.addEventListener("beforemenu-open",function(p){if(p.menu==="attachmentmenu"){xcalendarMail.mimeId=p["id"];rcmail.enable_command("add-events-to-calendar",$.inArray(p["id"],rcmail.env.xcalendar_mimeIds)!==-1)}});var xcalendarMail=new function(){this.mimeId=false;this.showSelectCalendarDialog=function(){var calendars=rcmail.env.xcalendar_calendars;var select=$("<select id='xcalendar-select-element'>");for(var key in calendars){if(calendars.hasOwnProperty(key)){select.append($("<option>",{value:calendars[key]["id"],text:calendars[key]["name"]}))}}var div=$("<div id='xcalendar-select-dialog'>").append($("<p>").text(rcmail.gettext("select_calendar_for_events","xcalendar"))).append(select);div.dialog({modal:true,resizable:false,closeOnEscape:true,title:rcmail.gettext("select_calendar","xcalendar"),close:function(){div.dialog("destroy").remove()},buttons:[{text:rcmail.gettext("add_events","xcalendar"),click:function(){xcalendarMail.addMessageEventsToCalendar($("#xcalendar-select-element").val());$(this).dialog("close")}},{text:rcmail.gettext("cancel"),click:function(){$(this).dialog("close")}}],width:400})};this.addMessageEventsToCalendar=function(calendarId){rcmail.http_post("xcalendar.addMessageEventsToCalendar",{uid:rcmail.env.uid,mbox:rcmail.env.mailbox,mimeId:this.mimeId,calendarId:calendarId},rcmail.set_busy(true,"loading"))}};